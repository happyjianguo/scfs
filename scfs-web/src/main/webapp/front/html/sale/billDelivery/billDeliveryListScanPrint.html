<!DOCTYPE html>
<html>
<title>合同合并打印</title>
<!-- FontAwesome 4.3.0 -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!--bootstrap-->
<link href="../../../css/bootstrap_min.css" rel="stylesheet"
	type="text/css" />
<!--AdminLTE theme-->
<link href="../../../css/AdminLTE_min.css" rel="stylesheet"
	type="text/css" />
<!-- <link href="css/AdminLT_skins/_all-skins.min.css" rel="stylesheet" type="text/css" /> -->
<link href="../../../css/jquery.tag-editor.css" rel="stylesheet"
	type="text/css" />
<link rel="stylesheet" href="../../../css/sys_setting_min.css">
<link rel="stylesheet" href="../../../css/mainframe_min.css">
<link rel="stylesheet"
	href="../../../js/plugins/bootstrap-table/bootstrap-table.min.css">
<style type="text/css">
@page {
	size: auto; /* auto is the initial value */
	margin: 0mm; /* this affects the margin in the printer settings */
}

body, table {
	font-size: 12px;
}

table {
	margin: auto;
	border-collapse: collapse;
}

table.head {
	font-size: 13px;
	margin-top: -5px;
}

table.head td {
	height: 10px;
	overflow: hidden;
	white-space: nowrap;
}

div.whole {
	margin: 0px auto;
	padding-top: 30px;
	width: 730px;
}

td {
	vertical-align: middle;
}

hr {
	margin: 5px 0 2px 0;
}

#qrcode {
	float: right;
}

#qrcode img {
	vertical-align: middle;
	margin: auto;
}

.online {
	text-decoration: underline;
}

.content {
	height: 30px;
}
</style>
</head>

<body>
	<div class="whole">
		<div class="print-top">
			<button class="btn btn-primary mb20 printBtn">打印</button>
			<button class="btn btn-default mb20 closeBtn">关闭</button>
		</div>
		<form class="form-horizontal form-inline" id="form1"
			data-url="billDeliveryListScanPrint/list/query">
			<table width="100%">
				<tr>
					<td colspan="4">
						<table width="100%" style="float: left; width: 100%;">
							<tr>
								<td colspan="2" align="center"
									style="font-size: 30px; padding-top: 5px;">销售合同</td>
							</tr>

							<tr>
								<td align="left" style="padding-top: 90px;"><span>甲方(卖方)：<label
										class="js-initform" id="businessUnitName"
										name="businessUnitName" /></span></td>
							</tr>
							<tr>

								<td align="left" style="padding-top: 5px;"><span>乙方(买方)：<label
										class="js-initform" id="customerChineseName"
										name="customerChineseName" /></span></td>
							</tr>
						</table> <!-- <div id="qrcode"></div> -->
					</td>
				</tr>
				<tr>
					<td style="width: 38px; text-align: left; padding-top: 55px;">一、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; padding-top: 55px;">甲乙双方于
						<label class="js-initform online" id="requiredSendDate"
						name="requiredSendDate"></label> &nbsp;在深圳南山区签订销售合同，商品信息如下：
					</td>
				</tr>



				<tr>
					<td colspan="4" style="border: 0; padding: 20px 0">
						<table width="100%" style="border: 0" class="billDelivery_table">
							<thead>
								<tr>
									<th
										style="width: 10%; border: 1px solid #000; padding: 5px; text-align: center;">
										编号</th>

									<th
										style="width: 8%; border: 1px solid #000; padding: 5px; text-align: center;">
										SKU</th>
									<th
										style="width: 20%; border: 1px solid #000; padding: 5px; text-align: center;">
										产品名称</th>
									<th
										style="width: 10%; border: 1px solid #000; padding: 5px; text-align: center;">
										数量</th>
									<th
										style="width: 16%; border: 1px solid #000; padding: 5px; text-align: center;">
										单价 (<label class="js-initform" id="currencyTypeEnName"
										name="currencyTypeEnName"></label>)
									</th>
									<th
										style="width: 15%; border: 1px solid #000; padding: 5px; text-align: center;">
										金额 (<label class="js-initform" id="currencyTypeEnName"
										name="currencyTypeEnName"></label>)
									</th>
								</tr>
								<tr>
									<td
										style="width: 10%; border: 1px solid #000; padding: 5px; text-align: center;"
										rowspan="2">Invoice No</td>
									<td
										style="width: 8%; border: 1px solid #000; padding: 5px; text-align: center;"
										rowspan="2">ITEM NO</td>
									<td
										style="width: 20%; border: 1px solid #000; padding: 5px; text-align: center;">
										Description</td>
									<td
										style="width: 10%; border: 1px solid #000; padding: 5px; text-align: center;">
										Quantity</td>
									<td
										style="width: 16%; border: 1px solid #000; padding: 5px; text-align: center;">
										Unit Price(<span><label class="js-initform"
											id="currencyTypeEnName" name="currencyTypeEnName" /></span>)
									</td>
									<td
										style="width: 15%; border: 1px solid #000; padding: 5px; text-align: center;">
										Money(<span><label class="js-initform"
											id="currencyTypeEnName" name="currencyTypeEnName" /></span>)
									</td>
								</tr>
							</thead>
							<tbody>

							</tbody>
							<tfoot>
								<tr>
									<td
										style="border: 1px solid #000; padding: 1px; text-align: center;">总金额:</td>
									<td style="border: 1px solid #000; padding: 1px;">
									<td style="border: 1px solid #000; padding: 1px;">
									<td
										style="border: 1px solid #000; padding: 1px; text-align: center;"><b><label
											class="js-initform" id="requiredSendNumStr"
											name="requiredSendNumStr" style="font-weight: bold;" /></b></td>
									<td style="border: 1px solid #000; padding: 1px;">
									<td
										style="border: 1px solid #000; padding: 1px; text-align: center;">
										<label class="js-initform" id="requiredSendAmountStr"
										name="requiredSendAmountStr"></label>
									</td>
								</tr>
							</tfoot>
						</table>
					</td>
				</tr>
				<tr class="content">
					<td style="width: 38px; text-align: left; border: 0 none;">二、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">包装样式及标准：原包装。</td>
				</tr>
				<tr class="content">
					<td style="width: 38px; text-align: left; border: 0 none;">三、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">交货方式：&nbsp;&nbsp;<label
						class="js-initform online" id=settleName name="settleName"></label>_&nbsp;。
					</td>
				</tr>
				<tr class="content">
					<td style="width: 38px; text-align: left; border: 0 none;">四、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">运输方式和费用负担：运输方式：&nbsp;&nbsp;<label
						class="js-initform online" id="transferModeName"
						name="transferModeName"></label>/；运输费用由乙方承担。
					</td>
				</tr>

				<tr class="content">
					<td style="width: 38px; text-align: left; border: 0 none;">五、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">验收办法：甲方以货物外包装完好交货。</td>
				</tr>
				<tr class="content">
					<td style="width: 38px; text-align: left; border: 0 none;">六、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">货物质量：若货物存在质量问题，由乙方自行解决。</td>
				</tr>
				<!--                     <tr class="content"> -->
				<!--                     	<td style="width: 38px;text-align: left;  border: 0 none;">七、</td> -->
				<!--                         <td colspan="3" style="width: 200px; text-align: left; border: 0 none;">结算方式、期限：乙方应在甲方向其指定供应商支付货款之日起&nbsp;&nbsp; <label class="js-initform online" id="fundAccountPeriod" name="fundAccountPeriod"></label>&nbsp; 日内向甲方支付货款。</td> -->
				<!--                     </tr> -->
				<tr class="content">
					<td style="width: 38px; text-align: left; border: 0 none;">七、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">结算方式：货到付款</td>
				</tr>
				<tr class="content">
					<td
						style="width: 38px; text-align: left; position: relative; top: -9px;">八、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">因本《销售合同》发生任何争议的，双方应及时协商解决，协商不成的，任何一方均可向合同签订地有管辖权的法院解决，本合同适用中华人民共和国法律。</td>
				</tr class="content">
				<tr class="content">
					<td style="width: 38px; text-align: left; border: 0 none;">九、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">本合同一式两份，双方各执一份，自双方加盖公章或合同章后生效。传真件为有效文件。</td>
				</tr>
				<tr>
					<td colspan="6" style="position: relative; top: 50px;">
						<table width="100%" style="float: left">
							<tr>
								<td align="left" style="padding: 10px;">甲方(卖方)：</td>
								<td>乙方(买方)：</td>
							</tr>
							<tr>
								<td align="left" style="padding: 10px;">授权代表：</td>
								<td>授权代表：</td>
							</tr>
							<tr>
								<td align="left" style="padding: 10px;">日期：</td>
								<td>日期：</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</form>
	</div>
	<script src="../../../js/lib/jquery-1.9.1.min.js"
		type="text/javascript"></script>
	<script src="../../../js/lib/qrcode.min.js" type="text/javascript"></script>
	<script src='../../../js/plugins/bootstrap-table/bootstrap-table.js'
		type='text/javascript'></script>
	<script
		src='../../../js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js'
		type='text/javascript'></script>
	<script src='../../../js/plugins/layer/layer.js' type='text/javascript'></script>
	<script src="../../../js/common.js"></script>
</body>
<script>
    var ids = GLOBAL.getParam("ids");
    GLOBAL.ajax("billDeliveryListScanPrint/list/query", {ids: ids}, function(result) {
        if (result.success) {
            var data =result.items;
            if (data) {
				$("#form1").find(".js-initform").each(function(){
				     var $this = $(this);
	                    var id = $this.attr("id");
	                    var toThound = $this.hasClass("toThound");
	                    data[id] = data[id] == null ? "" : data[id];
	                    if (this.nodeName.toLowerCase() == "label") {
	                        if (data[id] || data[id] == 0) {
	                        	var showValue = toThound && !isNaN(parseFloat(data[id])) ? parseFloat(data[id]).toThounds() : data[id];                            
	                            $this.text(showValue);
	                        }
	                    } else {
	                        $this.val(data[id]);
	                    }
				});
				poLine();
            }
        }
    });
    function  poLine(){
	    GLOBAL.ajax("billDeListScanPrintLine/list/query", {ids: ids}, function(result) {
        	if (result.items) {
        		var tbody = "";
        		var  countPayCurtAmount=0;
        		var requiredSendNumStr=0;
        		var requiredSendNum=0;
        		for (var i = 0; i < result.items.length; i++) {
        			var data = result.items[i];
        			countPayCurtAmount=data.countPayCurtAmount;
        			requiredSendNum=delcommafy(data.requiredSendNum)
        			requiredSendNumStr=parseFloat(requiredSendNumStr)+parseFloat(requiredSendNum);
        			if(data.goodsUnit==null)
        			{
        				data.goodsUnit ='';
        			}
        			if(data.goodsBarCode==null)
        			{
        				data.goodsBarCode ='';
        			}
        			var tr = "<tr>" 
        				    + "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.billNo + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.goodsNumber + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.goodsName + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.requiredSendNum + data.goodsUnit + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + (data.payCurtPrice).toFixed(2)+ "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + (data.payCurtAmount).toFixed(2) + "</td>"
	        				+ "</tr>";
        			tbody += tr;
                }
        		$("#requiredSendAmountStr").html(countPayCurtAmount.toFixed(2));
        		$("#requiredSendNumStr").html(requiredSendNumStr.toFixed(2));
                $(".billDelivery_table").find("tbody").append(tbody);             
        	}
	    });
    }
        $(".printBtn").click(function() {
            $(this).parent(".print-top").hide();
            closeAfterPrint();
        })
        $(".closeBtn").click(function() {
            window.close();
        })

        function closeAfterPrint() {
            if (document.execCommand("print")) {
                $(".print-top").show();

                GLOBAL.ajax("common/updatePrintNum", {id:id, billType:19}, function(){
					//layer.msg("打印次数 + 1");
				});
            } else
                setTimeout("CloseAfterPrint();", 1000);
        }

		function delcommafy(num){
			   if((num+"").trim()==""){
			      return "";
			   }
			   num=num.replace(/,/gi,'');
			   return num;
			}
		
        window.onafterprint = function() {
            alert("Printing completed...");
        }
    </script>

</html>
