<!DOCTYPE html>
<html>
<title>发票合并打印</title>
<!-- FontAwesome 4.3.0 -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!--bootstrap-->
<link href="../../../css/bootstrap_min.css" rel="stylesheet"
	type="text/css" />
<!--AdminLTE theme-->
<link href="../../../css/AdminLTE_min.css" rel="stylesheet"
	type="text/css" />
<!-- <link href="css/AdminLT_skins/_all-skins.min.css" rel="stylesheet" type="text/css" /> -->
<link href="../../../css/jquery.tag-editor.css" rel="stylesheet"
	type="text/css" />
<link rel="stylesheet" href="../../../css/sys_setting_min.css">
<link rel="stylesheet" href="../../../css/mainframe_min.css">
<link rel="stylesheet"
	href="../../../js/plugins/bootstrap-table/bootstrap-table.min.css">
<style type="text/css">
@page {
	size: auto; /* auto is the initial value */
	margin: 0mm; /* this affects the margin in the printer settings */
}

body, table {
	font-size: 14px;
}

table {
	margin: auto;
	border-collapse: collapse;
}

table.head {
	font-size: 13px;
	margin-top: -5px;
}

table.head td {
	height: 10px;
	overflow: hidden;
	white-space: nowrap;
}

div.whole {
	margin: 0px auto;
	padding-top: 30px;
	width: 730px;
}

td {
	vertical-align: middle;
}

hr {
	margin: 5px 0 2px 0;
}

#qrcode {
	float: right;
}

#qrcode img {
	vertical-align: middle;
	margin: auto;
}
</style>
</head>

<body>
	<div class="whole">
		<div class="print-top">
			<button class="btn btn-primary mb20 printBtn">打印</button>
			<button class="btn btn-default mb20 closeBtn">关闭</button>
		</div>
		<form class="form-horizontal form-inline" id="form1"
			data-url="billDelInvoiceListScanPrint/list/query">
			<table width="100%">
				<tr>
					<td colspan="4">
						<table width="100%" style="float: left; width: 100%;">
							<tr>
								<td align="center">
									<h4 style="padding: 8px;">
										<label class="js-initform" id="businessUnitEnglishName"
											name="businessUnitEnglishName" />
									</h4> <span style="font-size: 5px;"><label
										class="js-initform" id="businessUnitAddress"
										name="businessUnitAddress" /></span>
									<hr>
									<hr>
								</td>
							</tr>
							<tr>
								<td align="center" style="font-size: 23px; padding-top: 10px;">
									<strong>发&nbsp;&nbsp;票</strong>
								</td>
							</tr>
							<tr>
								<td align="center" style="font-size: 23px; padding: 10px;">
									<strong>INVOICE</strong>
								</td>
							</tr>
						</table>
						<div id="qrcode"></div>
					</td>
				</tr>



				<tr>
					<td class="pt10" colspan="4" style="border: 0; padding-top: 30px">
						<table id="js_dataTable" class="print-table" style="width: 100%">
							<!-- border:1px solid #000; -->
							<tr style="height: 30px;">
								<td
									style="width: 80px; border: 0; padding: 3px; text-align: right; padding-right: 5px;">BILL
									TO :</td>
								<td
									style="width: 210px; border: 0; padding: 0px 0; padding-left: 3px; text-align: left;">
									<label class="js-initform" id="customerChineseName"
									name="customerChineseName" />
								</td>
								<td
									style="width: 70px; border: 0; padding: 0px; text-align: right;">
									Invoice Date :</td>
								<td
									style="width: 110px; border: 0; padding: 0px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform online" id="requiredSendDate"
									name="requiredSendDate"></label> <!-- 2017-03-06-->
								</td>
							</tr>
							<tr>
								<td
									style="width: 40px; border: 0; padding: 3px; text-align: right; padding-right: 5px;">ADD
									:</td>
								<td
									style="width: 210px; border: 0; padding: 0px 0; padding-left: 3px; text-align: left;">
									<!-- 香港上环德辅道中272-284号兴业商业中心15楼1505室--> <label
									class="js-initform" id="customerAfficeName"
									name="customerAfficeName"></label>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td colspan="4" style="border: 0; padding: 20px 0">
						<table width="100%" style="border: 0" class="billDelivery_table">
							<thead>
								<tr>
									<td
										style="width: 10%; border: 1px solid #000; padding: 5px; text-align: center;">
										编号</td>
									<td
										style="width: 8%; border: 1px solid #000; padding: 5px; text-align: center;">
										SKU</td>
									<td
										style="width: 22%; border: 1px solid #000; padding: 5px; text-align: center;">
										货物品名及规格</td>
									<td
										style="width: 8%; border: 1px solid #000; padding: 5px; text-align: center;">
										数量</td>
									<td
										style="width: 17%; border: 1px solid #000; padding: 5px; text-align: center;">
										单价</td>
									<td
										style="width: 16%; border: 1px solid #000; padding: 5px; text-align: center;">
										总价</td>
									<!--                                 		<td style="width: 15%;border: 1px solid #000; padding: 5px; text-align: center;" rowspan="3"> -->
									<!--                                 			备注<br/>NOTE -->
									<!--                                 		</td> -->
								</tr>

								<tr>
									<td
										style="width: 10%; border: 1px solid #000; padding: 5px; text-align: center;">
										Invoice No</td>
									<td
										style="width: 8%; border: 1px solid #000; padding: 5px; text-align: center;">
										ITEM NO</td>
									<td
										style="width: 22%; border: 1px solid #000; padding: 5px; text-align: center;">
										Description specification</td>
									<td
										style="width: 8%; border: 1px solid #000; padding: 5px; text-align: center;">
										Quantity</td>
									<td
										style="width: 16%; border: 1px solid #000; padding: 5px; text-align: center;">
										Unit Price(<span><label class="js-initform"
											id="currencyTypeEnName" name="currencyTypeEnName" /></span>)
									</td>
									<td
										style="border: 1px solid #000; padding: 5px; text-align: center; white-space: nowrap">
										Total Amount(<span><label class="js-initform"
											id="currencyTypeEnName" name="currencyTypeEnName" /></span>)
									</td>
								</tr>
								<!--                                 	<tr> -->
								<!--                                 	</tr> -->
							</thead>
							<tbody>

							</tbody>
							<tfoot>
								<tr>
									<td
										style="border: 0; padding: 3px; text-align: center; border: 1px solid #000;">合计Total</td>
									<td
										style="border: 0; padding: 3px; text-align: center; border: 1px solid #000;"></td>
									<td
										style="border: 0; padding: 3px; text-align: center; border: 1px solid #000;"></td>
									<td
										style="border: 0; padding: 3px; text-align: center; border: 1px solid #000; padding: 0 5px;"><b><label
											class="js-initform" id="requiredSendNumStr"
											name="requiredSendNumStr" style="font-weight: bold;" /></b></td>
									<td
										style="border: 0; padding: 3px; text-align: center; border: 1px solid #000;"></td>
									<td
										style="border: 0; padding: 3px; text-align: center; border: 1px solid #000; padding: 0 5px;"><b><label
											class="js-initform" id="requiredSendAmountStr"
											name="requiredSendAmountStr" style="font-weight: bold;" /></b></td>
									<!--                                         <td style="border: 0; padding: 3px; text-align: center;border: 1px solid #000;"></td> -->
								</tr>
								<!-- 	                                <tr> -->
								<!-- 	                         			<td colspan="3"> -->
								<!-- 			                         		<b style="padding-left: 5px;">Total amount:</b> -->
								<!-- 			                         		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><label class="js-initform" id="requiredSendAmountSt" name="requiredSendAmountSt" style="font-weight: bold;" /></b> -->
								<!-- 			                         		&nbsp;&nbsp;<label class="js-initform " style="font-weight: bold;" id="currencyTypeEnName" name="currencyTypeEnName" /> -->
								<!-- 		                         		</td> -->
								<!-- 		                           </tr> -->
							</tfoot>
						</table>
					</td>
				</tr>
				<tr>
				</tr>

				<tr>
					<td colspan="8" style="padding: 15px 0;">
						<table style="width: 100%">
							<!-- <tr>HIP SHING GROUP LIMITED
                                    <td style="width:390px; border: 0; padding: 5px; text-align: left; padding-left: 5px;">户名 : <label class="js-initform" id="accountor" name="accountor"/></td>
                                    
                                    <td style="width:120px; border: 0; padding: 5px; text-align: right; padding-right: 5px;">签章:</td>
                                    <td style="padding: 5px 0; padding-left: 5px; text-align: left;">
                                    </td>
                                </tr>
                                <tr>DSB BANK (Hong Kong) Limited
                                    <td style="width:390px; border: 0; padding: 5px; text-align: left; padding-right: 5px;">BANK NAME: <label class="js-initform" id="bankName" name="bankName"></label></td>
                                </tr>
                                <tr>
                                    <td style="width:390px; border: 0; padding: 5px; text-align: left; padding-right: 5px;">BANK CODE: <label class="js-initform" id="bankCode" name="bankCode"></label></td>
                                </tr>
                                <tr>
                                    <td style="width:390px; border: 0; padding: 5px; text-align: left; padding-right: 5px;">SWIFT CODE</td>
                                </tr>
                                <tr>
                                    <td style="width:390px; border: 0; padding: 5px; text-align: left; padding-right: 5px;">美金账户</td>
                                </tr>
                                <tr>
                                    <td style="width:390px; border: 0; padding: 5px; text-align: left; padding-right: 5px;">港币账户</td>
                                </tr> -->
							<tr>
								<td
									style="width: 110px; border: 0; padding: 5px; text-align: left; padding-right: 5px;">户名
									:</td>
								<td
									style="width: 250px; padding: 5px 0; padding-left: 0px; text-align: left;">
									<label class="js-initform" id=subjectName name="subjectName"></label>
								</td>
								<td
									style="width: 160px; border: 0; padding: 5px; text-align: right; padding-right: 5px;">签章:</td>
								<td style="padding: 5px 0; padding-left: 5px; text-align: left;">
								</td>
							</tr>
							<tr>
								<td
									style="width: 110px; border: 0; padding: 5px; text-align: left; padding-right: 5px;">BANK
									NAME:</td>
								<td
									style="width: 250px; padding: 5px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="bankName" name="bankName"></label>
								</td>
							</tr>
							<tr>
								<td
									style="width: 110px; border: 0; padding: 5px; text-align: left; padding-right: 5px;">BANK
									CODE :</td>
								<td
									style="width: 250px; padding: 5px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="bankCode" name="bankCode"></label>
								</td>
							</tr>
							<tr>
								<td
									style="width: 110px; border: 0; padding: 5px; text-align: left; padding-right: 5px;">账户:</td>
								<td
									style="width: 250px; padding: 5px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="accountNo" name="accountNo"></label>
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</form>
	</div>
	<script src="../../../js/lib/jquery-1.9.1.min.js"
		type="text/javascript"></script>
	<script src="../../../js/lib/qrcode.min.js" type="text/javascript"></script>
	<script src='../../../js/plugins/bootstrap-table/bootstrap-table.js'
		type='text/javascript'></script>
	<script
		src='../../../js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js'
		type='text/javascript'></script>
	<script src='../../../js/plugins/layer/layer.js' type='text/javascript'></script>
	<script src="../../../js/common.js"></script>
</body>
<script>
    var ids = GLOBAL.getParam("ids");
    GLOBAL.ajax("billDelInvoiceListScanPrint/list/query", {ids: ids}, function(result) {
        if (result.success) {
            var data =result.items;
            if (data) {
				$("#form1").find(".js-initform").each(function(){
				     var $this = $(this);
	                    var id = $this.attr("id");
	                    var toThound = $this.hasClass("toThound");
	                    data[id] = data[id] == null ? "" : data[id];
	                    if (this.nodeName.toLowerCase() == "label") {
	                        if (data[id] || data[id] == 0) {
	                        	var showValue = toThound && !isNaN(parseFloat(data[id])) ? parseFloat(data[id]).toThounds() : data[id];                            
	                            $this.text(showValue);
	                        }
	                    } else {
	                        $this.val(data[id]);
	                    }
				});
				poLine();
            }
        }
    });
    function  poLine(){
	    GLOBAL.ajax("billDeInvListScanPrintLine/list/query", {ids: ids}, function(result) {
        	if (result.items) {
        		var tbody = "";
        		var  countPayCurtAmount=0;
        		var countSenNum=0;
        		for (var i = 0; i < result.items.length; i++) {
        			var data = result.items[i];
        			var requiredSendNum=delcommafy(data.requiredSendNum);
        			countSenNum=parseFloat(countSenNum)+parseFloat(requiredSendNum);
        			countPayCurtAmount=data.countPayCurtAmount;
        			var tr = "<tr>" 
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.billNo + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.goodsNumber + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.goodsName + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.requiredSendNum + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + (data.payCurtPrice).toFixed(2) + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + (data.payCurtAmount).toFixed(2)+ "</td>"
// 	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.remark + "</td>"
	        				+ "</tr>";
        			tbody += tr;
                }
        		$("#requiredSendAmountStr").html(countPayCurtAmount.toFixed(2));
        		$("#requiredSendNumStr").html(countSenNum.toFixed(2));
                $(".billDelivery_table").find("tbody").append(tbody);             
        	}
	    }); 
    }
        $(".printBtn").click(function() {
            $(this).parent(".print-top").hide();
            closeAfterPrint();
        })
        $(".closeBtn").click(function() {
            window.close();
        })
		function delcommafy(num){
			   if((num+"").trim()==""){
			      return "";
			   }
			   num=num.replace(/,/gi,'');
			   return num;
			}
        function closeAfterPrint() {
            if (document.execCommand("print")) {
                $(".print-top").show();

                GLOBAL.ajax("common/updatePrintNum", {id:id, billType:19}, function(){
					//layer.msg("打印次数 + 1");
				});
            } else
                setTimeout("CloseAfterPrint();", 1000);
        }

        window.onafterprint = function() {
            alert("Printing completed...");
        }
    </script>

</html>
