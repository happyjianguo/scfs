<!DOCTYPE html>
<html>
<title>销售单打印</title>
<!-- FontAwesome 4.3.0 -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!--bootstrap-->
<link href="../../../css/bootstrap_min.css" rel="stylesheet"
	type="text/css" />
<!--AdminLTE theme-->
<link href="../../../css/AdminLTE_min.css" rel="stylesheet"
	type="text/css" />
<!-- <link href="css/AdminLT_skins/_all-skins.min.css" rel="stylesheet" type="text/css" /> -->
<link href="../../../css/jquery.tag-editor.css" rel="stylesheet"
	type="text/css" />
<link rel="stylesheet" href="../../../css/sys_setting_min.css">
<link rel="stylesheet" href="../../../css/mainframe_min.css">
<link rel="stylesheet"
	href="../../../js/plugins/bootstrap-table/bootstrap-table.min.css">
<style type="text/css">
@page {
	size: auto; /* auto is the initial value */
	margin: 0mm; /* this affects the margin in the printer settings */
}

body, table {
	font-size: 14px;
}

table {
	margin: auto;
	border-collapse: collapse;
}

table.head {
	font-size: 13px;
	margin-top: -5px;
}

table.head td {
	height: 10px;
	overflow: hidden;
	white-space: nowrap;
}

div.whole {
	margin: 0px auto;
	padding-top: 30px;
	width: 730px;
}

td {
	vertical-align: middle;
}

hr {
	margin: 5px 0 2px 0;
}

#qrcode {
	float: right;
}

#qrcode img {
	vertical-align: middle;
	margin: auto;
}
</style>
</head>

<body>
	<div class="whole">
		<div class="print-top">
			<button class="btn btn-primary mb20 printBtn">打印</button>
			<button class="btn btn-default mb20 closeBtn">关闭</button>
		</div>
		<form class="form-horizontal form-inline" id="form1"
			data-url="billDelivery/detail">
			<table width="710px">
				<tr>
					<td colspan="4">
						<table width="100%" style="float: left; width: 500px;">
							<tr>
								<td align="center">
									<h3>
										<label class="js-initform" id="businessUnitName"
											name="businessUnitName" />
									</h3>
									<hr> <span>地址：<label class="js-initform"
										id="businessUnitAddress" name="businessUnitAddress" /></span> <span>电话:
										<label class="js-initform" id="businessUnitPhone"
										name="businessUnitPhone" />
								</span>
								</td>
							</tr>
							<tr>
								<td align="center" style="font-size: 20px; padding-top: 10px;">
									销售单</td>
							</tr>
							<tr>
								<td align="center" style="font-size: 14px; padding: 10px;">
									<strong>(<label class="js-initform" id="billNo"
										name="billNo"></label>)
								</strong>
								</td>
							</tr>
						</table>
						<div id="qrcode"></div>
					</td>
				</tr>
				<tr>
					<td style="width: 200px; text-align: right; border: 0 none;">项目:</td>
					<td
						style="width: 300px; padding-left: 5px; text-align: left; border: 0 none;">
						<label class="js-initform" id="projectName" name="projectName"></label>
					</td>
					<td style="width: 200px; text-align: right; border: 0 none;">打印日期:</td>
					<td
						style="width: 300px; padding-left: 5px; text-align: left; border: 0 none;">
						<label class="js-initform" id="systemTime" name="systemTime"></label>
					</td>
				</tr>

				<tr>
					<td class="pt10" colspan="4">
						<table id="js_dataTable" class="print-table"
							style="border: 1px solid #000; width: 99%">
							<tr>
								<td
									style="width: 120px; border: 0; padding: 0px; text-align: right; padding-right: 5px;">始发地:</td>
								<td
									style="border: 0; padding: 0px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="sendCityName"
									name="sendCityName"></label>
								</td>
								<td
									style="width: 120px; border: 0; padding: 0px; text-align: right; padding-right: 5px;">目的地:</td>
								<td
									style="border: 0; padding: 0px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="cityName" name="cityName"></label>
								</td>
							</tr>
							<tr>
								<td
									style="width: 120px; border: 0; padding: 0px; text-align: right; padding-right: 5px;">发货仓库:</td>
								<td
									style="border: 0; padding: 0px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="warehouseName"
									name="warehouseName"></label>
								</td>
								<td
									style="width: 120px; border: 0; padding: 0px; text-align: right; padding-right: 5px;">收货单位:</td>
								<td
									style="border: 0; padding: 0px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="customerName"
									name="customerName"></label>
								</td>
							</tr>
							<tr>
								<td
									style="width: 120px; border: 0; padding: 0px; text-align: right; padding-right: 5px;">发货地址:</td>
								<td
									style="border: 0; padding: 0px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="sendWarehouseAddressName"
									name="sendWarehouseAddressName"></label>
								</td>
								<td
									style="width: 120px; border: 0; padding: 0px; text-align: right; padding-right: 5px;">收货地址:</td>
								<td
									style="border: 0; padding: 0px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="customerAddress"
									name="customerAddress"></label>
								</td>
							</tr>
							<tr>
								<td
									style="width: 120px; border: 0; padding: 0px; text-align: right; padding-right: 5px;">运输方式:</td>
								<td
									style="border: 0; padding: 0px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="transferModeName"
									name="transferModeName"></label>
								</td>
								<td
									style="width: 120px; border: 0; padding: 3px; text-align: right; padding-right: 5px;">联系人:</td>
								<td
									style="border: 0; padding: 3px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="contactPerson"
									name="contactPerson"></label>
								</td>
							</tr>
							<tr>
								<td
									style="width: 120px; border: 0; padding: 0px; text-align: right; padding-right: 5px;">附属编号:</td>
								<td
									style="border: 0; padding: 0px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="affiliateNo" name="affiliateNo"></label>
								</td>
								<td
									style="width: 120px; border: 0; padding: 0px; text-align: right; padding-right: 5px;">联系电话:</td>
								<td
									style="border: 0; padding: 0px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="mobilePhone" name="mobilePhone"></label>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td colspan="4" style="border: 0; padding: 15px 0">
						<table width="99%" style="border: 0" class="billDelivery_table">
							<thead>
								<th
									style="width: 40px; border: 1px solid #000; padding: 5px; text-align: center;"></th>
								<th
									style="border: 1px solid #000; padding: 5px; text-align: center;">编号</th>
								<th
									style="border: 1px solid #000; padding: 5px; text-align: center;">条码</th>
								<th
									style="border: 1px solid #000; padding: 5px; text-align: center;">名称</th>
								<th
									style="border: 1px solid #000; padding: 5px; text-align: center;">型号</th>
								<th
									style="border: 1px solid #000; padding: 5px; text-align: center;">数量</th>
								<th
									style="border: 1px solid #000; padding: 5px; text-align: center;">单价</th>
								<th
									style="border: 1px solid #000; padding: 5px; text-align: center;">金额</th>
							</thead>
							<tbody>

							</tbody>
							<tfoot>
								<tr>
									<td style="border: 0; padding: 3px; text-align: right;"
										colspan="6">总数量:</td>
									<td style="border: 1px solid #000; padding: 0 5px;" colspan="2"><label
										class="js-initform" id="requiredSendNum"
										name="requiredSendNum" /></td>
								</tr>
								<tr>
									<td style="border: 0; padding: 3px; text-align: right;"
										colspan="6">总金额:</td>
									<td style="border: 1px solid #000; padding: 0 5px;" colspan="2">
										<label class="js-initform" id="requiredSendAmountStr"
										name="requiredSendAmountStr"></label> <label
										class="js-initform" id="currencyTypeName"
										name="currencyTypeName"></label>
									</td>
								</tr>
							</tfoot>
						</table>
					</td>
				</tr>
				<tr>
					<td colspan="8">发货备注：<label class="js-initform" id="remark" name="remark"></label></td>
				</tr>
				<tr>
					<td colspan="8">注意事项：</td>
				</tr>
				<tr>
					<td colspan="8" style="text-indent: 30px;">
						尊敬的客户，请您照本单所列产品名称、产品型号、数量、金额各项验收。如发生货损等异常情况，请在客户签收返回单上详细说明并在24小时内通知客服中心，我们将会及时处理。
					</td>
				</tr>
				<tr>
					<td colspan="8">签收标准(<label class="js-initform"
						id="signStandardName" name="signStandardName"></label>)： <span
						style="padding-right: 5px;"><span class="showCertificate">身份证号(<label
								class="js-initform" id="certificateId" name="certificateId"></label>)
								+签名(<label class="js-initform" id="certificateName"
								name="certificateName"></label>)
						</span> <span class="showAddSymbol">+</span><span
							class="showOfficialSeal">印章(<label class="js-initform"
								id="officialSeal" name="officialSeal"></label>)
						</span></span>
					</td>
				</tr>
				<tr>
					<td colspan="8" style="padding: 20px 0;">
						<table style="width: 100%">
							<tr>
								<td
									style="width: 120px; border: 0; padding: 5px; text-align: right; padding-right: 5px;">配送中心:</td>
								<td
									style="border: 0; width: 120px; padding: 5px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="payeeName" name="payeeName"></label>
								</td>
								<td
									style="width: 120px; border: 0; padding: 5px; text-align: right; padding-right: 5px;">运输公司:</td>
								<td
									style="border: 0; width: 120px; padding: 5px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="payeeName" name="payeeName"></label>
								</td>
								<td
									style="width: 220px; border: 0; padding: 5px; text-align: right; padding-right: 5px;">收货单位:</td>
								<td
									style="border: 0; width: 120px; padding: 5px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="payeeName" name="payeeName"></label>
								</td>
							</tr>
							<tr>
								<td
									style="width: 120px; border: 0; padding: 5px; text-align: right; padding-right: 5px;">发货人签名:</td>
								<td
									style="border: 0; width: 120px; padding: 5px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="payeeName" name="payeeName"></label>
								</td>
								<td
									style="width: 120px; border: 0; padding: 5px; text-align: right; padding-right: 5px;">收货人签名:</td>
								<td
									style="border: 0; width: 120px; padding: 5px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="payeeName" name="payeeName"></label>
								</td>
								<td
									style="width: 120px; border: 0; padding: 5px; text-align: right; padding-right: 5px;">收货人签名盖章:</td>
								<td
									style="border: 0; width: 120px; padding: 5px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="payeeName" name="payeeName"></label>
								</td>
							</tr>
							<tr>
								<td
									style="width: 120px; border: 0; padding: 5px; text-align: right; padding-right: 5px;">发货日期:</td>
								<td
									style="border: 0; width: 120px; padding: 5px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="payeeName" name="payeeName"></label>
								</td>
								<td
									style="width: 120px; border: 0; padding: 5px; text-align: right; padding-right: 5px;">收货日期:</td>
								<td
									style="border: 0; width: 120px; padding: 5px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="payeeName" name="payeeName"></label>
								</td>
								<td
									style="width: 120px; border: 0; padding: 5px; text-align: right; padding-right: 5px;">签收日期:</td>
								<td
									style="border: 0; width: 120px; padding: 5px 0; padding-left: 5px; text-align: left;">
									<label class="js-initform" id="payeeName" name="payeeName"></label>
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</form>
	</div>
	<script src="../../../js/lib/jquery-1.9.1.min.js"
		type="text/javascript"></script>
	<script src="../../../js/lib/qrcode.min.js" type="text/javascript"></script>
	<script src='../../../js/plugins/bootstrap-table/bootstrap-table.js'
		type='text/javascript'></script>
	<script
		src='../../../js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js'
		type='text/javascript'></script>
	<script src='../../../js/plugins/layer/layer.js' type='text/javascript'></script>
	<script src="../../../js/common.js"></script>
</body>
<script>
        var id = GLOBAL.getParam("id");
        var editData = GLOBAL.getEditData($("#form1"), id);

        //生成二维码, qrcode为二维码容器div的id，二维码的内容由text属性值指定，此例为editData.orderNo
        if (editData) {
			var qrcode = new QRCode("qrcode", {
			    text: editData.billNo,
			    width: 90,
			    height: 90,
			    colorDark : "#000000",
			    colorLight : "#ffffff",
			    correctLevel : QRCode.CorrectLevel.H
			});
			if (editData.signStandard == 0) {
				$('.showCertificate').show();
				$('.showAddSymbol').hide();
				$('.showOfficialSeal').hide();
			} else if (editData.signStandard == 1) {
				$('.showCertificate').hide();
				$('.showAddSymbol').hide();
				$('.showOfficialSeal').show();
			} else if (editData.signStandard == 2) {
				$('.showCertificate').show();
				$('.showAddSymbol').show();
				$('.showOfficialSeal').show();
			}
        }

	    GLOBAL.ajax("billDeliveryDtl/all/query", {billDeliveryId: id}, function(result) {
        	if (result.items) {
        		var tbody = "";
        		for (var i = 0; i < result.items.length; i++) {
        			var data = result.items[i];
        			if(data.goodsBarCode==null)
        			{
        				data.goodsBarCode='';
        			}
        			if(data.goodsUnit==null)
        			{
        				data.goodsUnit='';
        			}
        			var tr = "<tr>" 
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + (i + 1) + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.goodsNumber + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.goodsBarCode + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.goodsName + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.goodsType + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.requiredSendNum + data.goodsUnit + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.requiredSendPriceStr + "</td>"
	        				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.requiredSendAmountStr + "</td>"
	        				+ "</tr>";
        			tbody += tr;
                }
                $(".billDelivery_table").find("tbody").append(tbody);             
        	}
	    });
        
        $(".printBtn").click(function() {
            $(this).parent(".print-top").hide();
            closeAfterPrint();
        })
        $(".closeBtn").click(function() {
            window.close();
        })

        function closeAfterPrint() {
            if (document.execCommand("print")) {
                $(".print-top").show();

                GLOBAL.ajax("common/updatePrintNum", {id:id, billType:2}, function(){
					//layer.msg("打印次数 + 1");
				});
            } else
                setTimeout("CloseAfterPrint();", 1000);
        }

        window.onafterprint = function() {
            alert("Printing completed...");
        }
    </script>

</html>
