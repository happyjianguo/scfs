<!DOCTYPE html>
<html>
<title>合同</title>
<!-- FontAwesome 4.3.0 -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!--bootstrap-->
<link href="../../../css/bootstrap_min.css" rel="stylesheet"
	type="text/css" />
<!--AdminLTE theme-->
<link href="../../../css/AdminLTE_min.css" rel="stylesheet"
	type="text/css" />
<!-- <link href="css/AdminLT_skins/_all-skins.min.css" rel="stylesheet" type="text/css" /> -->
<link href="../../../css/jquery.tag-editor.css" rel="stylesheet"
	type="text/css" />
<link rel="stylesheet" href="../../../css/sys_setting_min.css">
<link rel="stylesheet" href="../../../css/mainframe_min.css">
<link rel="stylesheet"
	href="../../../js/plugins/bootstrap-table/bootstrap-table.min.css">
<style type="text/css">
@page {
	size: auto; /* auto is the initial value */
	margin: 0mm; /* this affects the margin in the printer settings */
}

body, table {
	font-size: 10px;
}

table {
	margin: auto;
	border-collapse: collapse;
}

table.head {
	font-size: 13px;
	margin-top: -5px;
}

table.head td {
	height: 10px;
	overflow: hidden;
	white-space: nowrap;
}

div.whole {
	margin: 0px auto;
	padding-top: 30px;
	width: 730px;
}

td {
	vertical-align: middle;
}

td input {
	border: none;
	text-align: right;
	padding: 5px;
	font-size: 12px;
	cursor: pointer;
	width: 86%;
}

hr {
	margin: 5px 0 2px 0;
}

#qrcode {
	float: right;
}

#qrcode img {
	vertical-align: middle;
	margin: auto;
}

.online {
	text-decoration: underline;
}
</style>
</head>

<body>
	<div class="whole">
		<div class="print-top">
			<button class="btn btn-primary mb20 printBtn">打印</button>
			<button class="btn btn-default mb20 closeBtn">关闭</button>
		</div>
		<form class="form-horizontal form-inline" id="form1"
			data-url="poPrint/detail">
			<input type="hidden" id="changeBeforPriceAmout"> <input
				type="hidden" id="changeBeforAmount">
			<table width="710px">
				<tr>
					<td colspan="4">
						<table width="100%" style="float: left; width: 99%;">
							<!--                             	<tr> -->
							<!--                                     <td align="right"> -->
							<!--                                         <span>编号为:<label class="js-initform" id="billNo" name="billNo"/></span> -->
							<!--                                     </td> -->
							<!--                                 </tr> -->
							<tr>
								<td align="center"
									style="font-size: 20px; padding-top: 5px; font-weight: 800;">
									Purchase Order</td>
							<tr>
								<td align="center"
									style="font-size: 20px; padding-top: 5px; font-weight: 800;"">
									采购订单</td>
							</tr>
							<tr>
								<td align="left" style="padding: 5px 30px 0px 40px;"><span>合同编号:<label
										class="js-initform" id="orderNo" name="orderNo" />
								</span> <span style="float: right">Date：<label
										class="js-initform" id="orderTime" name="orderTime" /></span></td>
							</tr>
							<tr>
								<td align="left" style="padding: 5px; padding-left: 40px;">
									<span>Seller：<label class="js-initform"
										id="supplierEnglishName" name="supplierEnglishName" /></span>
								</td>
							</tr>
							<tr>
								<td align="left" style="padding: 2px; padding-left: 40px;">
									<span>卖方：<label class="js-initform"
										id="supplierChineseName" name="supplierChineseName" /></span>
								</td>
							</tr>
							<tr>
								<td align="left" style="padding: 10px; padding-left: 40px;">
									<span>Buyer：<label class="js-initform"
										id="businessEnglishName" name="businessEnglishName" /></span>
								</td>
							</tr>
							<tr>
								<td align="left" style="padding: 0px; padding-left: 40px;">
									<span>买方：<label class="js-initform"
										id="businessChineseName" name="businessChineseName" /></span>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td colspan="2"
						style="width: 200px; text-align: left; padding-top: 14px; padding-left: 40px;">以下所有条款均适用于双方于<label
						class="js-initform" id="startDate" name="startDate"></label>签署的<span
						id="bizTypeName"></span><span>(以下简称"主合同"):</span></td>
				</tr>
				<tr>
					<td colspan="3"
						style="width: 200px; text-align: left; padding-top: 5px; padding-left: 40px;">The&nbsp;following&nbsp;terms&nbsp;shall&nbsp;apply&nbsp;to&nbsp;the&nbsp;Framework&nbsp;<span
						id="bizTypeEName"></span>(hereinafter&nbsp;referred
						&nbsp;as&nbsp;"Agreement")
					</td>
				</tr>
				<tr>
					<td colspan="4"
						style="width: 200px; text-align: left; padding-top: 5px; padding-left: 40px;">signed&nbsp;on&nbsp;day&nbsp;of&nbsp;<label
						class="js-initform" id="startDate" name="startDate"></label>;
					</td>
				</tr>
				<tr>
					<td style="width: 38px; text-align: left; padding-top: 25px;">一、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; padding-top: 25px;">货物品名和数量</td>
				</tr>
				<tr>
					<td colspan="4" style="border: 0; padding: 15px">
						<table width="100%" style="border: 0" class="poSearch_table">
							<thead>
								<th
									style="border: 1px solid #000; padding: 2px; text-align: center; width: 4%; vertical-align: middle;"><span>货号</span>
								<p>
										<br>ITEM NO
									</p></th>
								<th
									style="border: 1px solid #000; padding: 2px; text-align: center; width: 20%; vertical-align: middle;"><span>名称及规格</span>
								<p>
										<br>Name&Descriptions
									</p></th>
								<th
									style="border: 1px solid #000; padding: 2px; text-align: center; width: 10%; vertical-align: middle;"><span>数量</span>
								<p>
										<br>Qty(pcs)
									</p></th>
								<th
									style="border: 1px solid #000; padding: 2px; text-align: center; width: 12%; white-space: nowrap; vertical-align: middle;"><span>单价</span>
								<p>
										<br>Unit Price(<label class="js-initform" id="currency"
											name="currency"></label>)
									</p></th>
								<th
									style="border: 1px solid #000; padding: 2px; text-align: center; width: 12%; white-space: nowrap; vertical-align: middle;"><span>金额</span>
								<p>
										<br>Amount(<label class="js-initform" id="currency"
											name="currency"></label>)
									</p></th>
								<th
									style="border: 1px solid #000; padding: 2px; text-align: center; width: 14%; vertical-align: middle; white-space: nowrap;"><span>折扣金额</span>
								<p>Discount</p> Amount(<label class="js-initform" id="currency"
									name="currency"></label>)</th>
								<th
									style="border: 1px solid #000; padding: 2px; text-align: center; width: 24%; vertical-align: middle; white-space: nowrap;"><span>折后金额</span>
								<p>Discounted</p>Amount(<label class="js-initform"
									id="currencyTypeName" name="currencyTypeName"></label>)</th>
							</thead>
							<tbody>
							</tbody>
							<tfoot>
								<tr>
									<td style="border: 1px solid #000; padding: 0 5px;" colspan="1">总计：
										<label class="js-initform"></label>
									</td>
									<td style="border: 1px solid #000; padding: 0 5px;" colspan="1">
										<label class="js-initform"></label>
									</td>
									<td
										style="border: 1px solid #000; padding: 0 5px; text-align: center;"
										colspan="1" id="number"><label class="js-initform"></label>
									</td>
									<td style="border: 1px solid #000; padding: 0 5px;" colspan="1">
										<label class="js-initform"></label>
									</td>
									<td
										style="border: 1px solid #000; padding: 0 5px; text-align: center;"
										colspan="1" id="countAfterDeductionMoney"><label
										class="js-initform"></label></td>
									</td>
									<td
										style="border: 1px solid #000; padding: 0 5px; text-align: center;"
										colspan="1" id="sumDiscountAmount"><label
										class="js-initform"></label></td>
									<td
										style="border: 1px solid #000; padding: 0 5px; text-align: center;"
										colspan="1" id="totalPriceCountAmout"><label
										class="js-initform"></label></td>
								</tr>
							</tfoot>
						</table>
					</td>
				</tr>
				<tr>
					<td style="width: 38px; text-align: left; border: 0 none;">二、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">付款条件：以主合同为准</td>
				</tr>
				<tr>
					&nbsp;&nbsp;&nbsp;&nbsp;
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none; padding-left: 40px;">Terms&nbsp;of&nbsp;payment&nbsp;:shall&nbsp;be&nbsp;subjected&nbsp;to&nbsp;the&nbsp;Agreement
					</td>
				</tr>
				<tr>
					<td style="width: 38px; text-align: left; border: 0 none;">三、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">贸易条款:&nbsp;&nbsp;CIF香港</td>
				</tr>
				<tr>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none; padding-left: 40px;">Trade&nbsp;Term:&nbsp;CIF&nbsp;HK</td>
				</tr>
				<tr>
					<td style="width: 38px; text-align: left; border: 0 none;">四、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">唛头：&nbsp;&nbsp;SHIPPING&nbsp;MARKS</td>
				</tr>
				<tr>
					<td style="width: 38px; text-align: left; border: 0 none;">五、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">保险:卖方自理</td>
				</tr>
				<tr>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none; padding-left: 40px;">INSURANCE:&nbsp;TO&nbsp;BE&nbsp;COVERED&nbsp;BY&nbsp;THE&nbsp;SELLER</td>
				</tr>
				<tr>
					<td style="width: 38px; text-align: left; border: 0 none;">六、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">目的地：香港</td>
				</tr>
				<tr>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none; padding-left: 40px;">Port&nbsp;of&nbsp;Destination:&nbsp;HK</td>
				</tr>
				<tr>
					<td style="width: 38px; text-align: left; border: 0 none;">七、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">本订单未约定事项以主合同为准</td>
				</tr>
				<tr>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none; padding-left: 40px;">This&nbsp;unmentioned&nbsp;matters&nbsp;in&nbsp;this&nbsp;PO&nbsp;shall&nbsp;be&nbsp;subjected&nbsp;to&nbsp;the&nbsp;Agreement</td>
				</tr>
				<tr>
					<td style="width: 38px; text-align: left; border: 0 none;">八、</td>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none;">本合同共2份,自双方代表签字(盖章)之日起生效</td>
				</tr>
				<tr>
					<td colspan="3"
						style="width: 200px; text-align: left; border: 0 none; padding-left: 40px;">This&nbsp;contract&nbsp;is&nbsp;in&nbsp;two&nbsp;copies&nbsp;effective&nbsp;since&nbsp;being&nbsp;signed/sealed&nbsp;by&nbsp;both&nbsp;parties</td>
				</tr>
				<tr>
					<td colspan="6" style="position: relative; top: 25px;">
						<table width="100%" style="float: left">
							<tr>
								<td align="left" style="padding: 10px;">卖方：</td>
								<td style="padding: 10px;">买方：</td>
							</tr>
							<tr>
								<td align="left" style="padding: 10px;">sellers</td>
								<td style="padding: 10px;">buyers</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</form>
	</div>
	<script src="../../../js/lib/jquery-1.9.1.min.js"
		type="text/javascript"></script>
	<script src="../../../js/lib/qrcode.min.js" type="text/javascript"></script>
	<script src='../../../js/plugins/bootstrap-table/bootstrap-table.js'
		type='text/javascript'></script>
	<script
		src='../../../js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js'
		type='text/javascript'></script>
	<script src='../../../js/plugins/layer/layer.js' type='text/javascript'></script>
	<script src="../../../js/common.js"></script>
</body>
<script>
        var id = GLOBAL.getParam("id");
        var editData = GLOBAL.getEditData($("#form1"), id);
        if (editData == null) {
         	 layer.confirm('未查询到采购合同币种，是否关闭？', {
    	  	        btn: ['确定'] //按钮
    	  	    }, function() {
    	  	  	 	window.close();
    	  	    }, function() {});   
         }
        var bizType=editData.bizType;
        if(bizType==6){
        	$('#bizTypeName').html("《委托销售合同》");
        	$('#bizTypeEName').html("Entust&nbsp;Sales&nbsp;Contract");
        }else if(bizType==2){
        	$('#bizTypeName').html("《采购框架协议》");
        	$('#bizTypeEName').html("Purchase&nbsp;Agreement&nbsp;");
        }else{
       	 layer.confirm('未查询到采购合同业务类别，是否关闭？', {
	  	        btn: ['确定'] //按钮
	  	    }, function() {
	  	  	 	window.close();
	  	    }, function() {});   
        }
	    GLOBAL.ajax("poPrint/line/query", {id: id}, function(result) {
        	if (result.items) {
        		var tbody = "";
        		var number=0;
        		var countAfterDeductionMoney=0;
        		var totalPriceCountAmout=0;
        		var sumDiscountAmount=0;
        		for (var i = 0; i < result.items.length; i++) {
        			var data = result.items[i];
        			var goodsNum=data.goodsNum;
        			number=parseFloat(number)+parseFloat(goodsNum);
        			countAfterDeductionMoney=countAfterDeductionMoney+data.afterDeductionMoney;
        			sumDiscountAmount=data.sumDiscountAmount;
        			totalPriceCountAmout=data.totalPriceCountAmout;
        			var tr="";
        			if(i == 0){
        				$("#changeBeforPriceAmout").val((data.priceCountAmout).toFixed(2))
        				 tr = "<tr>" 
 	        				+ "<td style='border: 1px solid #000; padding: 2px; text-align: center;'> " + data.goodsNo + "</ >"
 	        				+ "<td style='border: 1px solid #000; padding: 2px; text-align: center;'> " + data.barSpecificationName + "</td>"
 	        				+ "<td style='border: 1px solid #000; padding: 2px; text-align: center;'> " + data.goodsNum+ "</td>"
 	        				+ "<td style='border: 1px solid #000; padding: 2px; text-align: center;'> " + (data.deductionPrice).toFixed(2)+ "</td>"
 	        				+ "<td style='border: 1px solid #000; padding: 2px; text-align: center;'> " + (data.afterDeductionMoney).toFixed(2) + "</td>"
 	        				+ "<td style='border: 1px solid #000; padding: 2px; text-align: center;'> " + (data.discountAmount).toFixed(2) + "</td>"
 	        				+ "<td style='border: 1px solid #000; padding: -1px 6px;text-align:center;'> <input  class='js_priceCount'  onkeyup='num(this)'  value='"+(data.priceCountAmout).toFixed(2)+"'></input></td>"
 	        				+ "</tr>";
        			}else{
        				 tr = "<tr>" 
 	        				+ "<td style='border: 1px solid #000; padding: 2px; text-align: center;'> " + data.goodsNo + "</ >"
 	        				+ "<td style='border: 1px solid #000; padding: 2px; text-align: center;'> " + data.barSpecificationName + "</td>"
 	        				+ "<td style='border: 1px solid #000; padding: 2px; text-align: center;'> " + data.goodsNum+ "</td>"
 	        				+ "<td style='border: 1px solid #000; padding: 2px; text-align: center;'> " + (data.deductionPrice).toFixed(2)+ "</td>"
 	        				+ "<td style='border: 1px solid #000; padding:2px; text-align: center;'> " + (data.afterDeductionMoney).toFixed(2) + "</td>"
 	        				+ "<td style='border: 1px solid #000; padding: 2px; text-align: center;'> " + (data.discountAmount).toFixed(2) + "</td>"
 	        				+ "<td style='border: 1px solid #000; padding: -1px 23px; text-align:center;''> " + (data.priceCountAmout).toFixed(2) + "</td>"
 	        				+ "</tr>";
        			}
        			tbody += tr;
                }
        		$("#number").html(number.toFixed(2));
        		$("#countAfterDeductionMoney").html(countAfterDeductionMoney.toFixed(2));
        		$("#totalPriceCountAmout").html(totalPriceCountAmout.toFixed(2));
        		$("#sumDiscountAmount").html(sumDiscountAmount.toFixed(2));
        		$("#changeBeforAmount").val(totalPriceCountAmout.toFixed(2));
                $(".poSearch_table").find("tbody").append(tbody);             
        	}
	    });
	    
	    function num(obj){
	    	obj.value = obj.value.replace(/[^\d.]/g,""); //清除"数字"和"."以外的字符
	    	obj.value = obj.value.replace(/^\./g,""); //验证第一个字符是数字
	    	obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个, 清除多余的
	    	obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
	    	obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3'); //只能输入两个小数
	    	}
	    
        $(".js_priceCount").change(function(){
        	var changePriceCountAmout=$(".js_priceCount").val();
        	if(changePriceCountAmout == null || changePriceCountAmout ==""){
        		changePriceCountAmout=0;
        	}
        	var changeBeforPriceAmout=$("#changeBeforPriceAmout").val();
        	var amount=$("#changeBeforAmount").val();
        	var changeAmount=parseFloat(amount) -parseFloat(changeBeforPriceAmout) +parseFloat(changePriceCountAmout);
        	$("#totalPriceCountAmout").html(changeAmount.toFixed(2));
        })
        
        $(".printBtn").click(function() {
            $(this).parent(".print-top").hide();
            closeAfterPrint();
        })
        $(".closeBtn").click(function() {
            window.close();
        })

        function closeAfterPrint() {
            if (document.execCommand("print")) {
                $(".print-top").show();

                GLOBAL.ajax("common/updatePrintNum", {id:id, billType:2}, function(){
					//layer.msg("打印次数 + 1");
				});
            } else
                setTimeout("CloseAfterPrint();", 1000);
        }

        window.onafterprint = function() {
            alert("Printing completed...");
        }
    </script>

</html>
