<div class="wrapper">
  <ol class="breadcrumb">
    <li>当前位置</li>
    <li>采购</li>
    <li class="active">基本信息编辑</li>
  </ol>
  <section class="product-wrap">
        <div class="box no-margin"> 
          <form class="form-horizontal form-inline" id="poEditForm" data-url="po/edit">
            <div class="box-body">
                <ul class="nav nav-tabs">
                  <li role="presentation" class="active"><a class="tab-item" data-url="html/purchase/poBaseInfoEdit.html">基础信息</a></li>
                  <li role="presentation"><a class="tab-item" id="orderDtlLink" data-url="html/purchase/poOrderDtlEdit.html">订单明细</a></li>
                  <li role="presentation"><a class="tab-item" data-url="html/purchase/attachment.html">附件</a></li>                 
                </ul>
                <input class="form-control js-initform" type="hidden" id="id" name="id">
                 <table class="table table-bordered table-hover no-margin">
                  <tr>
                      <td width="180" class="text-right"><b>项目：<em class="text-star">*</em></b></td>
                      <td class="text-left">
                          <select class="form-control js-initform" data-url="USER_PROJECT" id="projectId" pid="" name="projectId"></select>
                      </td>
                    </tr>
                    <tr>
                      <td class="text-right"><b>供应商：<em class="text-star">*</em></b></td>
                      <td class="text-left">
                        <select class="form-control js-initform" data-url="PROJECT_SUPPLIER" id="supplierId" pid="projectId" name="supplierId"></select>
                      </td>
                    </tr>
                    <tr>
                      <td class="text-right"><b>客户：</b></td>
                      <td class="text-left">
                        <select class="form-control js-initform" data-url="PROJECT_CUSTOMER" id="customerId" pid="projectId" name="customerId"></select>
                      </td>
                    </tr>
                    <tr>
                      <td class="text-right"><b>币种：<em class="text-star">*</em></b></td>
                      <td class="text-left">
                        <select class="form-control js-initform" data-url="DEFAULT_CURRENCY_TYPE" id="currencyId" name="currencyId"></select>
                      </td>
                    </tr>
                    <tr>
                      <td class="text-right"><b>附属编号：<em class="text-star">*</em></b></td>
                      <td class="text-left">
                        <input type="text" class="form-control js-initform" id="appendNo" name="appendNo">
                      </td>
                    </tr>
                    <tr>
                      <td class="text-right"><b>订单日期：<em class="text-star">*</em></b></td>
                      <td class="text-left">
                        <input type="text" class="form-control js-initform js_datePicker" id="orderTime" name="orderTime">
                      </td>
                    </tr>
                    <tr>
                      <td class="text-right"><b>预计到货时间：<em class="text-star">*</em></b></td>
                      <td class="text-left">
                        <input type="text" class="form-control js-initform js_datePicker" id="perdictTime" name="perdictTime">
                      </td>
                    </tr>
                    <tr>
                      <td class="text-right"><b>收货仓库：<em class="text-star">*</em></b></td>
                      <td class="text-left">
                        <select class="form-control js-initform" data-url="PROJECT_WAREHOUSE" id="warehouseId" pid="projectId" name="warehouseId"></select>
                      </td>
                    </tr>
                    <tr>
                      <td class="text-right"><b>仓库地址：<em class="text-star">*</em></b></td>
                      <td class="text-left">
                        <select class="form-control js-initform" data-url="SUBJECT_ADDRESS" id="wareAddrId" pid="warehouseId" name="wareAddrId"></select>
                      </td>
                    </tr>
                    <tr>
                      <td class="text-right"><b>要求付款：<em class="text-star">*</em></b></td>
                      <td class="text-left">
                        <select class="form-control js-initform" data-url="PO_REQUEST_PAY" id="isRequestPay" name="isRequestPay"></select>
                      </td>
                    </tr>
                    <tr class="hideByRequestPay">
                      <td class="text-right"><b>付款方式：<em class="text-star">*</em></b></td>
                      <td class="text-left">
                        <select class="form-control js-initform" data-url="PAY_ORDER_WAY" id="payWayId" name="payWay"></select>
                      </td>
                    </tr>

                    <tr class="hideByRequestPay"><td class="text-right"><b>收款账号：<em class="text-star">*</em></b></td>
                      <td class="text-left">
                        <select class="form-control js-initform" data-url="SUBJECT_ACCOUNT" id="accountId" pid="supplierId" name="accountId"></select>
                      </td>
                    </tr>

                    <tr class="hideByRequestPay"><td class="text-right"><b>要求付款时间：<em class="text-star">*</em></b></td>
                      <td class="text-left">
                        <input type="text" class="form-control js-initform js_datePicker" id="requestPayTime" name="requestPayTime">
                      </td>
                    </tr>
                   <tr class="hideByRequestPay"><td class="text-right"><b>预收订金：</b></td>
                     <td class="text-left">
                       <input type="text" class="form-control  js-initform" id="perRecAmount" name="perRecAmount">
                     </td>
                   </tr>

                   <tr id="openType-tr" style="display: none">
                     <td class="text-right"><b>开立类型：<em class="text-star">*</em></b></td>
                     <td class="text-left">
                       <input type="text" class="form-control js-initform" id="openType" name="openType" />
                   </tr>


                   <tr>
                      <td class="text-right"><b>预收订金水单号：</b></td>
                      <td class="text-left">
                        <input type="text" class="form-control js-initform" id="cBankWater" name="cBankWater">
                    </tr>                  
                    <tr>
                      <td class="text-right"><b>备注：</b></td>
                      <td class="text-left">
                        <textarea class="form-control js-initform" id="remark" cols="50" rows="5" name="remark"></textarea>  
                      </td>
                    </tr>
                  </table>
            </div>
            <!-- /.box-body -->

            <div class="box-footer text-center">
              <button type="submit" id="save" class="btn btn-primary btn-sm" data-url="po/update" data-permissionUrl="/po/update">保存</button>
              <button type="button" data-url="html/purchase/poSearch.html" class="btn btn-default btn-sm js-back">返回</button>
            </div>
            <!-- /.box-footer -->

          </form>
        </div>
  </section>
</div>
 
<script id="edit">
  options.initPage = function(){
      GLOBAL.getEditData($("#poEditForm"), options.param.id);
//    options.param.projectId = ;
      var value = $("#isRequestPay").val();
	   $("#orderTime,#perdictTime,#requestPayTime").datetimepicker({format:"Y-m-d", timepicker:false});
      if(value == "1"){
          $(".hideByRequestPay").show();
      }else{
          $(".hideByRequestPay").hide().find("[name]").val("");
      }

    var payWay = $("#payWayId").val();
    if(payWay == "2"){
      $("#openType-tr").css("display","");
    }

      $("#poEditForm").validate({
          rules: {
              projectId: {
                required: true
              },
              supplierId: {
                required: true
              },
              currencyId: {
                required: true
              },
              appendNo: {
                required: true
              },
              orderTime: {
                required: true
              },
              perdictTime: {
                required: true
              },
              warehouseId: {
                required: true
              },
              wareAddrId: {
                required: true
              },
              isRequestPay: {
                required: true
              },
              payWay: {
                required: true
              },
              accountId: {
                required: true
              },
            openType: {
              required: true,
              number:true
            },
              requestPayTime: {
                required: true
              }
          },
          submitHandler: function() {
            var saveUrl = "po/update";
            var formData = $("#poEditForm").serializeObject();
            GLOBAL.ajax(saveUrl, formData,
              function(e) {
                  if (e.success) {
                      layer.msg("保存成功！");
                  } else {
                      layer.msg(e.msg);
                  }
            });
          }
      });
  }

  $("#isRequestPay").change(function(){
      var value = $(this).val();
      if(value == "1"){
          $(".hideByRequestPay").show();
      }else{
          $(".hideByRequestPay").hide().find("[name]").val("");
      }
  })
 
  $(".tab-item").click(function(){
      var url = $(this).data("url");
//      options.param.id = options.param.cid;
      GLOBAL.go(url);
  })
  //付款方式为承兑汇票,需要显示开立类型
  $("#payWayId").change(function(){
    var value = $(this).val();
    if(value == "2"){
      $("#openType-tr").css("display","");
    }else{
      $("#openType-tr").css("display","none");
    }
    //清空 requestPayTime  accountId openType
    $("#requestPayTime").val("");
    $("#accountId").val("");
    $("#perRecAmount").val("");
    $("#openType").val("");
  })


  GLOBAL.goBack();
  
</script>
