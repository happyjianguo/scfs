
<div class="wrapper">
  <section class="content-header my-content-header">
		<ol class="breadcrumb">
			<li>当前位置</li>
			<li>资金</li>
			<li>付款</li>
			<li class="active">编辑</li>
		</ol>
  </section>
  <section class="product-wrap">
        <div class="box no-margin"> 
          <form class="form-horizontal form-inline" id="form1" data-url="payOrder/edit">
            <div class="box-body">
                <ul class="nav nav-tabs">
                    <li role="presentation" class="active"><a class="tab-item"data-url="html/pay/payBaseInfoEdit.html">基础信息</a></li>
					<li role="presentation" class="li-po"><a class="tab-item" data-url="html/pay/payOrderEdit.html">订单信息</a></li>
					<li role="presentation" class="li-fee"><a class="tab-item" data-url="html/pay/payFeeEdit.html">费用信息</a></li>
					<li role="presentation" class="li-refund"><a class="tab-item" data-url="html/pay/payRefundEdit.html">退款信息</a></li>
					<li role="presentation" class="li-advance"><a class="tab-item" data-url="html/pay/payAdvanceEdit.html">预收单信息</a></li>
					<li role="presentation" class="li-deduction-fee"><a class="tab-item" data-url="html/pay/payDeductionFeeEdit.html">抵扣费用信息</a></li>
                    <li role="presentation" class="li-attachment"><a class="tab-item" data-url="html/pay/attachment.html">附件</a></li>
                    <li role="presentation" class="li-voucher"><a class="tab-item" data-url="html/pay/payVoucherEdit.html">付款凭证</a></li>
                </ul>
                <input class="form-control js-initform" type="hidden" id="id" name="id">
                 <table class="table table-bordered table-hover no-margin">
                 	<tr>
						<td class="text-right"><b>附属编号：<em class="text-star">*</em></b></td>
						<td class="text-left"><input type="text"
							class="form-control js-initform" id="attachedNumbe" name="attachedNumbe">
						</td>
					</tr>
                 <tr>
						<td class="text-right"><b>付款编号：</b></td>
						<td class="text-left"><label class="js-initform"
							id="payNo" name="payNo"></label></td>
					</tr>
					<tr>
						<td width="180" class="text-right"><b>付款类型：</b></td>
						<td class="text-left"><label class="js-initform"
							id="payTypeName" name="payTypeName"></label></td>
					</tr>
					<tr>
						<td width="180" class="text-right"><b>项目：</b></td>
						<td class="text-left"><label class="js-initform"
							id="projectName" name="projectName"></label></td>
					</tr>
					<tr>
						<td class="text-right"><b>付款单位：</b></td>
						<td class="text-left"><label class="js-initform"
							id="payerName" name="payerName"></label></td>
					</tr>
                    <tr>
                      <td class="text-right"><b>付款方式：<em
								class="text-star">*</em></b></td>
                      <td class="text-left">
                        <select class="form-control js-initform" data-url="PAY_ORDER_WAY" id="payWay" name="payWay"></select>
                      </td>
                    </tr>
                    
                    <tr>
                      <td class="text-right"><b>支付类型：<em
								class="text-star">*</em></b></td>
                      <td class="text-left">
                        <select class="form-control js-initform" data-url="PAY_WAY_TYPE" id="payWayType" name="payWayType"></select>
                      </td>
                    </tr>
                    
                    <tr id="openType-tr" style="display: none">
	                     <td class="text-right"><b>开立类型：<em class="text-star">*</em></b></td>
	                     <td class="text-left">
	                       <input type="text" class="form-control js-initform" id="openType" name="openType" />
                    </tr>
                    
                    <tr>
                      <td class="text-right"><b>是否无单据付款：<em
								class="text-star">*</em></b></td>
                      <td class="text-left">
                      	<label class="js-initform" id="noneOrderFlagName" name="noneOrderFlagName"></label>
                      </td>
                    </tr>
                    
                    <tr>
						<td width="180" class="text-right"><b>币种：<em
								class="text-star">*</em></b></td>
						<td class="text-left">
							<label  class="form-control js-initform" id="currnecyTypeName" name="currnecyTypeName" readonly="readonly"></label>
						</td>
					</tr>
                    
                    <tr>
                      <td class="text-right"><b>付款金额：<em
								class="text-star">*</em></b></td>
                      <td class="text-left">
                          <input type="text" class="form-control js-initform" id="payAmount" name="payAmount"></input>
                      </td>
                    </tr>
                    <tr>
						<td class="text-right"><b>收款单位：</b></td>
						<td class="text-left"><label class="js-initform"
							id="payeeName" name="payeeName"></label></td>
					</tr>
                    <tr>
                      <td class="text-right"><b>收款账户：<em
								class="text-star">*</em></b></td>
                      <td class="text-left">
                        <select class="form-control js-initform" data-url="SUBJECT_ACCOUNT" id="payAccountId" pid="payee" name="payAccountId"></select>
                      </td>
                    </tr>	
                    <tr class="hideByRequestPay">
						<td class="text-right"><b>开户行</b></td>
                        <td class="text-left">
                            <label class="js-initform"  id="bankName" name="bankName"></label>
                        </td>
					</tr>
                    <tr class="hideByRequestPay">
                        <td class="text-right"><b>收款银行地址</b></td>
                        <td class="text-left">
                            <label class="js-initform"  id="bankAddress" name="bankAddress"></label>
                        </td>
                     </tr>
                     <tr class="hideByRequestPay">
                     	  <td class="text-right"><b>收款账号开户人</b></td>
                        <td class="text-left">
                          <label class="js-initform"  id="subjectName" name="subjectName"></label>
                        </td>
                     </tr>
                     <tr class="hideByRequestPay">
                     	  <td class="text-right"><b>收款银行账号</b></td>
                        <td class="text-left">
                          <label class="js-initform"  id="accountNo" name="accountNo"></label>
                        </td>
                     </tr>
                     <tr class="hideByRequestPay">
                     	  <td class="text-right"><b>收款银行代码</b></td>
                        <td class="text-left">
                          <label class="js-initform"  id="bankCode" name="bankCode"></label>
                        </td>
                     </tr>
                     <tr class="hideByRequestPay">
                     	  <td class="text-right"><b>收款人电话</b></td>
                        <td class="text-left">
                          <label class="js-initform"  id="phoneNumber" name="phoneNumber"></label>
                        </td>
                     </tr>
                    <tr>
                      <td class="text-right"><b>要求付款日期：<em
								class="text-star">*</em></b></td>
                      <td class="text-left">
                        <input type="text" class="form-control js-initform js_datePicker" id="requestPayTime" name="requestPayTime">
                      </td>
                    </tr>
                    <tr>
                      <td class="text-right"><b>备注：</b></td>
                      <td class="text-left">
                        <textarea class="form-control js-initform" id="remark" cols="50" rows="5" name="remark"></textarea>  
                      </td>
                    </tr>
                  </table>
            </div>
            <!-- /.box-body -->

             <div class="box-footer text-center">
              <button type="submit" id="save" class="btn btn-primary btn-sm" data-permissionUrl="/payOrder/update" data-url="payOrder/update">保存</button>
              <button type="button" id="back" data-url="html/pay/paySearch.html" class="btn btn-default btn-sm js-back">返回</button>
            </div>
            <!-- /.box-footer -->

          </form>
        </div>
  </section>
</div>

<script src="../../js/pay/payCommon.js"></script> 
<script>
options.initPage = function(){
    var editData = GLOBAL.getEditData($("#form1"), options.param.id);
    
    var payType = options.param.payType;
    var noneOrderFlag = options.param.noneOrderFlag;
	var stateInt = options.param.stateInt;
	if (noneOrderFlag == 0) {	//有单据付款
		if (payType == 1 || payType == 2) { //付款类型为货款或者费用，付款金额根据付款明细计算，不可手动编辑
	    	$("#payAmount").attr("readonly" , "readonly");
	    }
	} else if (noneOrderFlag == 1 && stateInt == 6) {	//无单据付款且已完成
		$(":input").attr("readonly" , "readonly");
        $("#payWay").prop("disabled", true);
        $("#payWayType").prop("disabled", true);
        $("#payAccountId").prop("disabled", true);
	}
	showTab(payType, stateInt, noneOrderFlag);
    
    if($("#subjectType").val()==2){
    	$("#warehouseTr").show();
    }
    
    var payWay = $("#payWay").val();
    if(payWay == "2"){
      	$("#openType-tr").css("display","");
    }
    
    $("#form1").validate({
        rules: {
            payWay: {
                required: true
            },
            payWayType: {
                required: true
            },
            openType: {
                required: true,
                digits : true
            },
            currnecyType: {
                required: true
            },
            payAmount: {
                required: true
            },
            payAccountId: {
                required: true
            },
            confirmorAt: {
                required: true
            },
            attachedNumbe : {
				required : true,
				maxlength : 50
			},
			remark : {
				maxlength : 200
			}
        },
        submitHandler: function() {
          var data = $("#form1").serialize();
          var pattern = /^[0-9]*(\.[0-9]{1,2})?$/;
			var payAmount = $("#payAmount");
			if (!pattern.test(payAmount.val())) {
				layer.msg("请输入正确格式");
				payAmount.focus();
			} else {
	          GLOBAL.ajax("payOrder/update",data, function(e){
	        	  if (e.success) {
	            	  layer.msg("保存成功！", {
	                      icon: 1,
	                      time: 1500
	                  },function(){
	                	  //GLOBAL.go("html/pay/paySearch.html");
	                  });
	              } else {
	                  layer.msg(e.msg);
	              }
	          });
			}
        }
    });
    $(".js_datePicker").datetimepicker({
        format:'Y-m-d',
    });
};

$(".tab-item").click(function(){
    var url = $(this).data("url");
    GLOBAL.go(url, options.param);
})

$("#payAccountId").change(function(){
        var value = $(this).val();
        if(value){
        	GLOBAL.ajax("baseSubject/account/edit?id=" + value, null, function(data){
            	$("#bankAddress").text(data.items.bankAddress);
            	$("#subjectName").text(data.items.subjectName);
            	$("#accountNo").text(data.items.accountNo);
            	$("#bankCode").text(data.items.bankCode);
            	$("#phoneNumber").text(data.items.phoneNumber);
            	$("#bankName").text(data.items.bankName);
            })
            $(".hideByRequestPay").show();
        }else{
        	$(".hideByRequestPay").hide();
        }
    })


//付款方式为承兑汇票,需要显示开立类型
  $("#payWay").change(function(){
    var value = $(this).val();
    if(value == "2"){
      $("#openType-tr").css("display","");
    }else{
      $("#openType-tr").css("display","none");
    }
    //清空 openType
    $("#openType").val("");
  })


GLOBAL.goBack();
  
</script>
