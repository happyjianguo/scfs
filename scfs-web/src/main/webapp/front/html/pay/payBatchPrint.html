<!DOCTYPE html>
<html>
<title>支付打印</title>
<!-- FontAwesome 4.3.0 -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- FontAwesome 4.3.0 -->
<link href="../../../fonts/font-awesome-4.4.0/css/font-awesome.min.css"
	rel="stylesheet" type="text/css" />
<!-- Ionicons 2.0.1 -->
<link href="../../../fonts/ionicons-2.0.1/css/ionicons.min.css"
	rel="stylesheet" type="text/css" />
<!--bootstrap-->
<link href="../../../css/bootstrap_min.css" rel="stylesheet"
	type="text/css" />
<!--AdminLTE theme-->
<link href="../../../css/AdminLTE_min.css" rel="stylesheet"
	type="text/css" />
<!-- <link href="css/AdminLT_skins/_all-skins.min.css" rel="stylesheet" type="text/css" /> -->
<link href="../../../css/jquery.tag-editor.css" rel="stylesheet"
	type="text/css" />
<!--web css-->
<link rel="stylesheet"
	href="../../../js/plugins/jquery.datetimepicker/jquery.datetimepicker.css">
<link rel="stylesheet" href="../../../css/sys_setting_min.css">
<link rel="stylesheet" href="../../../css/mainframe_min.css">
<link rel="stylesheet"
	href="../../../js/plugins/bootstrap-table/bootstrap-table.min.css">
<style type="text/css">
@page {
	size: auto; /* auto is the initial value */
	margin: 0mm; /* this affects the margin in the printer settings */
}

body, table {
	font-size: 14px;
}

table {
	margin: auto;
	border-collapse: collapse;
	border: 1px solid #ccc;
}

table.head {
	font-size: 13px;
	margin-top: -5px;
}

table.head td {
	height: 10px;
	overflow: hidden;
	white-space: nowrap;
}

div.whole {
	margin: 0px auto;
	padding-top: 30px;
	width: 730px;
}

td {
	vertical-align: middle;
	border: 1px solid #ccc;
	padding: 10px 0;
}

hr {
	margin: 5px 0 2px 0;
}

#qrcode img {
	vertical-align: middle;
	margin: auto;
}

.diffAmount, .diffAmount1 {
	display: none;
}
</style>
</head>

<body>
	<div class="whole">
		<div class="print-top">
			<button class="btn btn-primary mb20 printBtn">打印</button>
			<button class="btn btn-default mb20 closeBtn">关闭</button>
		</div>
		<form class="form-horizontal form-inline" id="form1"
			data-url="payOrder/detail">
			<h1 style="text-align: center; padding: 20px 0">付款申请</h1>
			<p style="text-align: right;">
				<strong>打印流水：<label class="js-initform"
					id="unionPrintIdentifier" name="unionPrintIdentifier" /></strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</p>
			<table width="710px">
				<tr>
					<td style="width: 240px; text-align: right; border: 0 none;">项目名称:</td>
					<td
						style="width: 260px; padding-left: 5px; text-align: left; border: 0 none;"><label
						class="js-initform" id="projectName" name="projectName" /></td>
					<td style="width: 240px; text-align: right; border: 0 none;">经营单位:</td>
					<td
						style="width: 260px; padding-left: 5px; text-align: left; border: 0 none;"><label
						class="js-initform" id="payerName" name="payerName" /></td>
				</tr>
				<tr>
					<td style="width: 240px; text-align: right; border: 0 none;">付款类型:</td>
					<td
						style="width: 260px; padding-left: 5px; text-align: left; border: 0 none;"><label
						class="js-initform" id="payTypeName" name="payTypeName" /></td>
					<td style="width: 240px; text-align: right; border: 0 none;">付款方式:</td>
					<td
						style="width: 260px; padding-left: 5px; text-align: left; border: 0 none;"><label
						class="js-initform" id="payWayName" name="payWayName" /></td>
				</tr>
				<tr>
					<td style="width: 240px; text-align: right; border: 0 none;">要求付款日期:</td>
					<td
						style="width: 260px; padding-left: 5px; text-align: left; border: 0 none;"><label
						class="js-initform" id="requestPayTime" name="requestPayTime" /></td>
				</tr>
				<tr>
					<td colspan="4" style="border: 0;">
						<table width="80%" style="border: 2px solid #000;">
							<tr>
								<td
									style="border: 0; padding: 5px; text-align: right; padding-right: 5px;">付款对象:</td>
								<td
									style="border: 0; padding: 5px 0; padding-left: 5px; text-align: left;"><label
									class="js-initform" id="payeeName" name="payeeName" /></td>
							</tr>
							<tr>
								<td
									style="border: 0; padding: 5px; text-align: right; padding-right: 5px;">开户人:</td>
								<td
									style="border: 0; padding: 5px 0; padding-left: 5px; text-align: left;"><label
									class="js-initform" id="subjectName" name="subjectName" /></td>
							</tr>
							<tr>
								<td
									style="border: 0; padding: 5px; text-align: right; padding-right: 5px;">开户银行:</td>
								<td
									style="border: 0; padding: 5px 0; padding-left: 5px; text-align: left;"><label
									class="js-initform" id="bankName" name="bankName" /></td>
							</tr>
							<tr>
								<td
									style="border: 0; padding: 5px; text-align: right; padding-right: 5px;">银行地址:</td>
								<td
									style="border: 0; padding: 5px 0; padding-left: 5px; text-align: left;"><label
									class="js-initform" id="bankAddress" name="bankAddress" /></td>
							</tr>
							<tr>
								<td
									style="border: 0; padding: 5px; text-align: right; padding-right: 5px;">银行账号:</td>
								<td
									style="border: 0; padding: 5px 0; padding-left: 5px; text-align: left;"><label
									class="js-initform" id="accountNo" name="accountNo" /></td>
							</tr>
							<tr>
								<td
									style="border: 0; padding: 5px; text-align: right; padding-right: 5px;">银行代码:</td>
								<td
									style="border: 0; padding: 5px 0; padding-left: 5px; text-align: left;"><label
									class="js-initform" id="bankCode" name="bankCode" /></td>
							</tr>
							<tr>
								<td
									style="border: 0; padding: 5px; text-align: right; padding-right: 5px;">IBAN:</td>
								<td
									style="border: 0; padding: 5px 0; padding-left: 5px; text-align: left;"><label
									class="js-initform" id="iban" name="iban" /></td>
							</tr>
							<tr>
								<td
									style="border: 0; padding: 5px; text-align: right; padding-right: 5px;">币种:</td>
								<td
									style="border: 0; padding: 5px 0; padding-left: 5px; text-align: left; font-size: 20px"><label
									class="js-initform" id="currnecyTypeName"
									name="currnecyTypeName" /></td>
							</tr>
							<tr>
								<td
									style="border: 0; padding: 5px; text-align: right; padding-right: 5px;">付款金额:</td>
								<td
									style="border: 0; padding: 5px 0; padding-left: 5px; text-align: left; font-size: 20px"><label
									class="js-initform toThound" id="sumPayAmount"
									name="sumPayAmount" /></td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
			<div>
				<p>
				<div class="mt15 pl10 pr10">
					<h4 class="mb10">付款列表记录</h4>
					<table id="js_order_dataTable" data-url="payOrder/batchPrint/query"
						style="font-size: 7px;"></table>
				</div>
				</p>
				<p>
				<div class="mt15 pl10 pr10">
					<h4 class="mb10">审核记录</h4>
					<table id="js_audit_dataTable"
						data-url="payOrder/auditflow/audit/query"></table>
				</div>
				</p>
				<p>
				<div
					style="float: left; width: 200px; text-align: left; padding: 20px">收款人签字:</div>
				<div
					style="float: left; margin-left: 50px; width: 200px; text-align: left; padding: 20px">收款日期:</div>
				</p>
			</div>
		</form>
	</div>
	<script src="../../js/lib/jquery-1.9.1.min.js" type="text/javascript"></script>
	<script src="../../js/lib/qrcode.min.js" type="text/javascript"></script>
	<script src='../../js/plugins/bootstrap-table/bootstrap-table.js'
		type='text/javascript'></script>
	<script
		src='../../js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js'
		type='text/javascript'></script>
	<script src='../../js/plugins/layer/layer.js' type='text/javascript'></script>
	<script src="../../js/common.js"></script>
</body>
<script>
/*数据表格*/
var tabColsLog = [{
    title: '序号',
    field: 'columnsNumber',
    width: '5%'
}, {
    title: '流程节点',
    field: "stateName",
    width: '15%'
}, {
    title: '处理人',
    field: "dealName",
    width: '15%'
}, {
    title: '处理意见',
    field: "suggestion",
    width: '25%'
}, {
    title: '开始时间',
    field: "createTime",
    width: '15%'
}, {
    title: "处理时间",
    field: "dealTime",
    width: '15%'
}, {
    title: "处理状态",
    field: "auditStateName",
    width: '10%'
}];

var tabColsOrder = [{
    title: '序号',
    field: 'columnsNumber',
    width: '5%'
}, {
    title: '付款编号',
    field: "payNo",
    width: '25%'
}, {
    title: '附属编号',
    field: "attachedNumbe",
    width: '25%'
}, {
    title: '内部打款',
    field: "innerPayDate",
    width: '15%'
}, {
    title: '折扣率',
    width: '15%',
    formatter : function(value , row , index) {
    	if (row.innerPayDate != null) {
			return  row.sumProfit ;
    	}
	}
},{
    title: '金额',
    field: "payAmount",
    width: '15%'
}];

	var ids = GLOBAL.getParam("ids");
	var idArr = ids.split(",");
	var param = {
		ids : idArr
	}
	var callback = function(e) {
		if (e.items != null) {
			var payOrderResDto = e.items.payOrderResDto;
			var sumPayAmount = e.items.sumPayAmount;
			$("#form1").find(".js-initform").each(function(){
				var _self = $(this);
				var key = _self.attr("id");
				_self.html(payOrderResDto[0][key]);
			});
			$("#form1").find("#sumPayAmount").html(sumPayAmount);
			
			GLOBAL.initTable($('#js_order_dataTable'), tabColsOrder, null, payOrderResDto, {pagination: false});
		}
	}
	GLOBAL.ajax("payOrder/batchPrint/query", JSON.stringify(param) , function(e) {
		if (e.success) {
			callback(e);
		} else {
			layer.msg(e.msg);
		}
	}, true);

	GLOBAL.initTable($('#js_audit_dataTable'), tabColsLog, {
        projectItemId: idArr[0]
    }, null, {
        pagination: false
    });
	
	$(".printBtn").click(function() {
		$(this).parent(".print-top").hide();
		closeAfterPrint();
	})
	$(".closeBtn").click(function() {
		window.close();
	})

	function closeAfterPrint() {
		if (document.execCommand("print")) {
			$(".print-top").show();
			var data = {
				ids  : ids ,
				billType : 5
			}
			
			GLOBAL.ajax("common/batchUpdatePrintNum", data, function() {
			});
		} else
			setTimeout("CloseAfterPrint();", 1000);
	}

	window.onafterprint = function() {
		alert("Printing completed...");
	}
</script>

</html>
