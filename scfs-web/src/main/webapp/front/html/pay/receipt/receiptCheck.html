<style>

.diffAmount {
	display: none;
}

.projectTwo,.projectOne,.custOne,.custTwo,.custThree{
	display: none;
}
.receiptType, .writeOffAmount, .writeOffCurrency, .paidAmount, .receiptWay, .payUnitName,.diffAm,.recAccount_2{
    display: none;
   }
</style>

<div class="wrapper">
  <section class="content-header my-content-header">
	  <ol class="breadcrumb">
	    <li>当前位置</li>
	    <li>资金</li>
	    <li>水单</li>
	    <li class="active">核销</li>
	  </ol>
  </section>
	<section class="product-wrap">
		<div class="box no-margin">
			<form class="form-horizontal form-inline" id="form1"
				data-url="bankReceipt/edit">
				<div class="box-body">
					<ul class="nav nav-tabs">
						<li role="presentation" class="active"><a class="tab-item" data-url="html/pay/receipt/receiptCheck.html">基础信息</a></li>
						<li role="presentation" class="one"><a class="tab-item" id="orderDtlLink" data-url="html/pay/receipt/receiptRelCheck.html">应收核销</a></li>
						<li role="presentation" class="three"><a class="tab-item"  data-url="html/pay/receipt/receiptOutStoreCheck.html">核销</a></li>
						<li role="presentation" class="two"><a class="tab-item" id="orderDtlLink" data-url="html/pay/receipt/receiptAdvanCheck.html">预收明细</a></li>
						<li role="presentation" class="four"><a class="tab-item"data-url="html/pay/receipt/receiptCopeCheck.html">应付核销</a></li>
						<li role="presentation" class="five"><a class="tab-item"  data-url="html/pay/receipt/receiptPrepaidCheck.html">预付明细</a></li>
						<li role="presentation"><a class="tab-item" id="orderDtlLink" data-url="html/pay/receipt/attachment.html">附件</a></li>
					</ul>
					<input class="form-control js-initform" type="hidden" id="id"
						name="id">
					<table class="table table-bordered table-hover no-margin">
						<tr class="projectOne">
							<td width="180" class="text-right"><b>项目：<em
									class="text-star">*</em></b></td>
							<td class="text-left"><select
								class="form-control  js-initform" data-url="BUSI_UNIT_PROJECT"
								id="projectId" pid="busiUnit" name="projectId"></select></td>
						</tr>
						<tr class="projectTwo">
							<td width="180" class="text-right"><b>项目：</b></td>
							<td class="text-left">
                         		 <label class=" js-initform"  id="projectName" name="projectName"></label>
                      		</td>
						</tr>
						<tr class="custOne">
							<td width="180" class="text-right"><b>客户：<em
									class="text-star">*</em></b></td>
							<td class="text-left"><select
								class="form-control js-initform" data-url="PROJECT_BCS"
								id="custId" pid="projectId" name="custId"></select></td>
							</td>
						</tr>
						<tr class="custTwo">
								<td width="180" class="text-right"><b>客户：</b></td>
								<td class="text-left">
									 <label class="js-initform" id="cusName" name="cusName" ></label></td>
	                      		</td>
						</tr>
						<tr class="custThree">
										<td class="text-right"><b>客户：<em class="text-star">*</em></b></td>
										<td class="text-left"><select
													class="form-control js-initform" data-url="BCS"
												  id="custIdName"	 name="custId"></select></td>
										</td>
							</tr>
						<tr class="diffAmount">
							<td class="text-right"><b>手续费：</b></td>
							<td class="text-left"><input
								class="form-control js-initform" id="diffAmount"
								name="diffAmount" value="0"></input></td>
						</tr>
						<tr>
							<td class="text-right"><b>水单编号：</b></td>
							<td class="text-left"><label class="js-initform"
								id="receiptNo" name="receiptNo"></label></td>
						</tr>
						
						<tr class="receiptType">
							<td class="text-right"><b>水单类型：</b></td>
							<td class="text-left"><label class="js-initform"
								id="receiptTypeName" name="receiptTypeName"></label></td>
						</tr>
						<tr>
							<td class="text-right"><b>银行水单号：</b></td>
							<td class="text-left"><label class="js-initform"
								id="bankReceiptNo" name="bankReceiptNo"></label></td>
						</tr>

						<tr>
							<td width="180" class="text-right"><b>经营单位：</b></td>
							<td class="text-left"><label class="js-initform"
								id="busiUnitName" name="busiUnitName"></label></td>
						</tr>

						<tr class="recAccount_1">
							<td class="text-right"><b>收款账户：</b></td>
							<td class="text-left"><label class="js-initform"
								id="recAccountNoName" name="recAccountNoName"></label></td>
						</tr>
						<tr class="recAccount_2">
							<td class="text-right"><b>付款账户：</b></td>
							<td class="text-left"><label class="js-initform"
								id="recAccountNoName" name="recAccountNoName"></label></td>
						</tr>
						<tr class="gearbest_title">
							<td class="text-right"><b>日期：</b></td>
							<td class="text-left"><label type="text"
								class=" js-initform" id="receiptDate" name="receiptDate"></label>
							</td>
						</tr>

						<tr>
							<td class="text-right"><b>水单金额：</b></td>
							<td class="text-left"><label class="js-initform toThound"
								id="receiptAmount" name="receiptAmount"></label></td>
						</tr>

						<tr>
							<td width="180" class="text-right"><b>币种：</b></td>
							<td class="text-left"><label class="js-initform"
								id="currencyTypeName" name="currencyTypeName"></label></td>
						</tr>
						<tr class="writeOffAmount">
							<td width="180" class="text-right"><b>核销金额：</b></td>
							<td class="text-left"><label class="js-initform"
								id="writeOffAmount" name="writeOffAmount"></label></td>
						</tr>
						<tr class="writeOffCurrency">
							<td width="180" class="text-right"><b>核销币种：</b></td>
							<td class="text-left"><label class="js-initform"
								id="currencyTypeName" name="currencyTypeName"></label></td>
						</tr>
						<tr class="paidAmount">
							<td width="180" class="text-right"><b>预付金额：</b></td>
							<td class="text-left"><label class="js-initform"
								id="paidAmount" name="paidAmount"></label></td>
						</tr>
						<tr class="diffAm">
							<td width="180" class="text-right"><b>尾差：</b></td>
							<td class="text-left"><label class="js-initform"
								id="diffAmount" name="diffAmount"></label></td>
						</tr>
                    <tr  class="receiptWay">
                      <td class="text-right"><b>付款方式：<em
								class="text-star"></em></b></td>
                      <td class="text-left">
                     <label class="js-initform"
								id="receiptWayName" name="receiptWayName"></label></td>
                    </tr>
            		<tr class="payUnitName">
						<td class="text-right"><b>收款单位：</b></td>
						<td class="text-left"><label class="js-initform" id=payUnitName name="payUnitName"></label></td>
					</tr>
						<tr>
							<td class="text-right"><b>摘要：</b></td>
							<td class="text-left"><label class="js-initform"
								id="summary" name="summary"></label></td>
						</tr>
					</table>
				</div>
				<!-- /.box-body -->

				<div class="box-footer text-center">
					<button type="submit" id="save" class="btn btn-primary btn-sm" data-permissionUrl="/bankReceipt/check"
						data-url="bankReceipt/check">保存</button>
					<button type="button" id="back"
						data-url="html/pay/receipt/receiptSearch.html"
						class="btn btn-default btn-sm js-back">返回</button>
				</div>
				<!-- /.box-footer -->

			</form>
		</div>
	</section>
</div>
<script src="../../js/pay/receiptCommon.js"></script> 
<script>
options.initPage = function(){
	$(".js_datePicker").datetimepicker({format:"Y-m-d", timepicker:false});
    var editData = GLOBAL.getEditData($("#form1"), options.param.id);
    if (editData) {
    	$("#diffAmount").val(editData.actualDiffAmount);
    }
    var tabId = options.param.type;
    var custId = $("#custId").val();
     if(custId==null){
    	 custId=editData.custId;
     }
    var way = options.param.way;
    if(tabId == 2 || tabId==3){
    	$(".projectTwo").show();
    	$(".custTwo").show();
    	$("#save").hide();
    }else{
    	$(".projectOne").show();
    	$(".custOne").show();
    	if(way==1){
    		$(".diffAmount").show();
    	}
    }
    if(custId){
    	showTab(tabId);
        if(tabId==5){
        	$(".projectOne").hide();
        	$(".projectTwo").hide();
        	$(".custOne").hide();
        	$(".custTwo").hide();
        	$(".custThree").show();
        	$("#custIdName").val(custId);
        }
       if(tabId == 9  ||tabId == 10){
    	   $(".receiptType").show();
    	   $(".writeOffAmount").show();
    	   $(".writeOffCurrency").show();
    	   $(".paidAmount").show();
    	   $(".payUnitName").show();
    	   $(".diffAm").show();
    	   $(".diffAmount").hide();
    	   $(".projectTwo").show();
    	   $(".projectOne").hide();
    	   $(".custOne").hide();
    	   $(".custTwo").show();
    	   $(".custThree").hide();
    	   $(".receiptWay").show();
    	   $(".recAccount_2").show();
    	   $(".recAccount_1").hide();
       }
       if(tabId == 10){
    		$("#save").hide();
       }
    }
    $("#form1").validate({
        rules: {
        	projectId: {
                  	required:true
            },
            custId: {
                required: true
            }
        },
        submitHandler: function() {
            var pattern = /^[0-9]*(\.[0-9]{1,2})?$/;
			var diffAmount = $("#diffAmount");
			if (!pattern.test(diffAmount.val())) {
				layer.msg("请输入正确格式");
				diffAmount.focus();
			} else {
				  if(diffAmount.val()==""){
					  diffAmount.val("0");
				  }
				  var data = $("#form1").serialize();
		          GLOBAL.ajax("bankReceipt/check",data, function(e){
		        	  if (e.success) {
		            	  layer.msg("保存成功！", {
		                      icon: 1,
		                      time: 1500
		                  },function(){
		                	  GLOBAL.go("html/pay/receipt/receiptCheck.html");
		                  });
		              } else {
		                  layer.msg(e.msg);
		              }
		          });
			}
        }
    });
    
};

$(".tab-item").click(function(){
    var url = $(this).data("url");
    GLOBAL.go(url, options.param);
})

GLOBAL.goBack();
  
</script>
