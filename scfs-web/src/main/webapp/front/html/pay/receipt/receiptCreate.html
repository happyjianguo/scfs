
<div class="wrapper">
	<section class="content-header my-content-header">
		<ol class="breadcrumb">
			<li>当前位置</li>
			<li>资金</li>
			<li>水单</li>
			<li class="active">新建水单信息</li>
		</ol>
	</section>
	<section class="product-wrap">
		<div class="box no-margin">
			<form class="form-horizontal" id="payForm">
				<div class="box-body">
					<div class="row">
						<div class="col-md-6">
							<table class="table table-bordered table-hover no-margin">
								<tr>
									<td class="text-right"><b>水单类型：</b><em class="text-star">*</em></td>
									<td class="text-left">
									<select class="form-control js-select" data-url="RE_RECEIPT_TYPE" id="receiptType" name="receiptType"></select>
									</td>
								</tr>
								<tr>
									<td width="180" class="text-right"><b>经营单位：<em
											class="text-star">*</em></b></td>
									<td class="text-left"><select
										class="form-control js-select" data-url="BUSI_UNIT"
										id="busiUnit" name="busiUnit"></select></td>
								</tr>
								<tr>
									<td class="text-right"><b>银行水单号：<em class="text-star">*</em></b></td>
									<td class="text-left">
										<input type="text" class="form-control" id="bankReceiptNo" name="bankReceiptNo">
									</td>
								</tr>
								
								<tr>
			                        <td class="text-right"><b>收款账户：<em class="text-star">*</em></b></td>
			                        <td class="text-left">
			                          <select class="form-control js-select" data-url="SUBJECT_ACCOUNT" id="recAccountNo" pid="busiUnit" name="recAccountNo"></select>
			                        </td>
			                    </tr>
			                    
								<tr>
									<td class="text-right"><b>水单金额：<em class="text-star">*</em><em
											class="text-star"></em></b></td>
									<td class="text-left">
										<input type="text" class="form-control" id="receiptAmount" name="receiptAmount">
									</td>
								</tr>
								
								<tr>
									<td width="180" class="text-right"><b>币种：<em
											class="text-star">*</em></b></td>
									<td class="text-left"><select
										class="form-control js-select" data-url="DEFAULT_CURRENCY_TYPE"
										id="currencyType" name="currencyType"></select></td>
								</tr>

								<tr class="gearbest_title">
									<td class="text-right"><b>水单日期：<em
											class="text-star">*</em></b></td>
									<td class="text-left"><input type="text"
										class="form-control js_datePicker" id="receiptDate"
										name="receiptDate"></td>
								</tr>
								
								<tr>
			                      <td class="text-right"><b>收款方式：<em class="text-star">*</em></b></td>
			                      <td class="text-left">
			                        <select class="form-control js-select" data-url="PAY_ORDER_WAY" id="receiptWay"  name="receiptWay"></select>
			                      </td>
			                    </tr>
								
								<tr id="openType-tr" style="display: none">
				                     <td class="text-right"><b>开立类型：<em class="text-star">*</em></b></td>
				                     <td class="text-left">
				                       <input type="text" class="form-control" id="openType" name="openType" />
			                    </tr>
			                    
			                    <tr id="openDate-tr" style="display: none">
				                     <td class="text-right"><b>开立日期：<em class="text-star">*</em></b></td>
				                      <td class="text-left"><input type="text"class="form-control js_datePicker" id="openDate"name="openDate"></td>
			                    </tr>
								<tr id="busiType-tr">
									<td class="text-right"><b>项目：<em class="text-star">*</em></b></td>
									<td class="text-left"><select
										class="form-control  js-initform" data-url="BUSI_UNIT_PROJECT"
										id="projectId" pid="busiUnit" name="projectId"></select></td>
								</tr>
								<tr id="cust-tr">
									<td class="text-right"><b>客户：<em class="text-star">*</em></b></td>
									<td class="text-left"><select
										class="form-control js-initform" data-url="PROJECT_BCS"
										id="custId" pid="projectId"  name="custId"></select></td>
									</td>
								</tr>
								<tr id="custId-tr" style="display: none">
									<td class="text-right"><b>客户：<em class="text-star">*</em></b></td>
									<td class="text-left"><select
										class="form-control js-select" data-url="BCS"
										  name="custId"></select></td>
									</td>
								</tr>
								<tr>
									<td class="text-right"><b>付款单位：<em
											class="text-star"></em></b></td>
									<td class="text-left">
										<input type="text" class="form-control" id="payUnit" name="payUnit">
									</td>
								</tr>
								<tr>
									<td class="text-right"><b>摘要：<em class="text-star">*</em><em
											class="text-star"></em></b></td>
									<td class="text-left">
										<input type="text" class="form-control" id="summary" name="summary">
									</td>
								</tr>
							</table>
						</div>
					</div>

				</div>
				<!-- /.box-body -->
				 <div class="box-footer text-center">
	              <button type="submit" id="save" data-url="bankReceipt/add" data-permissionUrl="/bankReceipt/add" class="btn btn-primary btn-sm">保存</button>
	              <button type="button" id="js-back" data-url="html/pay/receipt/receiptSearch.html" class="btn btn-default btn-sm js-back">返回</button> 
	            </div>
				<!-- /.box-footer -->

			</form>
		</div>
	</section>
</div>
<script>
	
var options = {
	    param: {
	      id: 0,
	      cid:0,
	    },
		initPage: function(){
			$(".js_datePicker").datetimepicker({format:"Y-m-d", timepicker:false});
	        $("#payForm").validate({
	            rules: {
	            	receiptType: {
	                  	required: true
	                },
	            	busiUnit: {
	                  	required: true
	                },
	                bankReceiptNo: {
	                  	required: true,
	                  	maxlength:50
	                },
	                recAccountNo: {
	                  	required: true
	                },
	                receiptAmount: {
	                  	required: true
	                },
	                receiptDate: {
	                  	required: true
	                },
	                currencyType: {
	                    required: true
	                },
	                receiptWay: {
	                    required: true
	                },
	                openType: {
	                    required: true,
	                    digits : true
	                },
	                openDate: {
	                    required: true
	                },
	                projectId: {
	                    required: true,
	                    digits : true
	                },
	                custId: {
	                    required: true,
	                    digits : true
	                },
	                summary: {
	                    required: true
	                },
	                payUnit: {
	                  	maxlength:100
	                }
	            },
	            submitHandler: function() {
	              var data = $("#payForm").serialize();
	              var pattern = /^[0-9]*(\.[0-9]{1,2})?$/;
					var receiptAmount = $("#receiptAmount");
					if (!pattern.test(receiptAmount.val())) {
						layer.msg("请输入正确格式");
						receiptAmount.focus();
					} else {
		              GLOBAL.ajax("bankReceipt/add",data, function(e){
		            	  console.log(e);
	                      layer.msg("保存成功！", {
	                          icon: 1,
	                          time: 1500
	                      },function(){
	                    	  GLOBAL.go("html/pay/receipt/receiptSearch.html", null);
	                      })
	                      
	                  },false,$("#save"));
				   }
	            }
	        });
	    }
	};
	//付款方式为承兑汇票,需要显示开立类型
	$("#receiptWay").change(function(){
	  var value = $(this).val();
	  if(value == "2"){
	    $("#openType-tr").css("display","");
	    $("#openDate-tr").css("display","");
	  }else{
	    $("#openType-tr").css("display","none");
	    $("#openDate-tr").css("display","none");
	  }
	  //清空 openType
	  $("#openType").val("");
	  $("#openDate").val("");
	});
	// 水单类型为内部 清除项目
 $("#receiptType").change(function(){
	  var value = $(this).val();
	 if(value=="5"){
		   $("#busiType-tr").css("display","none");	
		   $("#cust-tr").css("display","none");
		   $("#custId-tr").css("display","");
	 }else{
		  $("#busiType-tr").css("display","");
		  $("#cust-tr").css("display","");
		   $("#custId-tr").css("display","none");
	 }
 });
	GLOBAL.goBack();
</script>