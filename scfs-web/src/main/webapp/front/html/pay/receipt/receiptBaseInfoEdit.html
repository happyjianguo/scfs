
<div class="wrapper">
  <section class="content-header my-content-header">
	  <ol class="breadcrumb">
	    <li>当前位置</li>
	    <li>资金</li>
	    <li>水单</li>
	    <li class="active">编辑</li>
	  </ol>
  </section>
  <section class="product-wrap">
        <div class="box no-margin"> 
          <form class="form-horizontal form-inline" id="form1" data-url="bankReceipt/edit">
            <div class="box-body">
                <ul class="nav nav-tabs">
                  <li role="presentation" class="active"><a class="tab-item" data-url="html/pay/receipt/receiptBaseInfoEdit.html">基础信息</a></li>
                  <li role="presentation" ><a class="tab-item" data-url="html/pay/receipt/attachmentEdit.html">附件</a></li>
                </ul>
                 <input class="form-control js-initform" type="hidden" id="id" name="id">
                 <table class="table table-bordered table-hover no-margin">
					<tr>
						<td class="text-right"><b>银行水单号：<em class="text-star">*</em></b></td>
						<td class="text-left">
							<input type="text" class="form-control js-initform" id="bankReceiptNo" name="bankReceiptNo">
						</td>
					</tr>
					
					
					<tr>
						<td width="180" class="text-right"><b>经营单位：<em
								class="text-star">*</em></b></td>
						<td class="text-left">
							 <select class="form-control js-initform" data-url="BUSI_UNIT" pid="" id="busiUnit" name="busiUnit"></select>
						 </td>
					</tr>
					
					<tr>
                      <td class="text-right"><b>收款账户：</b></td>
                      <td class="text-left">
                        <select class="form-control js-initform" data-url="SUBJECT_ACCOUNT" id="recAccountNo" pid="busiUnit" name="recAccountNo"></select>
                      </td>
                    </tr>
					
					<tr class="gearbest_title">
						<td class="text-right"><b>日期：<em
								class="text-star">*</em></b></td>
						<td class="text-left"><input type="text"
							class="form-control js-initform js_datePicker" id="receiptDate"
							name="receiptDate"></td>
					</tr>
					
					<tr>
						<td class="text-right"><b>水单金额：<em class="text-star">*</em></b></td>
						<td class="text-left"><input type="text" class="form-control js-initform"
								id="receiptAmount" name="receiptAmount"></input>
						</td>
					</tr>
					
					<tr>
						<td width="180" class="text-right"><b>币种：<em
								class="text-star">*</em></b></td>
						<td class="text-left"><select
							class="form-control js-initform" data-url="DEFAULT_CURRENCY_TYPE"
							id="currencyType" name="currencyType"></select></td>
					</tr>
					
					<tr>
                      <td class="text-right"><b>付款方式：<em class="text-star">*</em></b></td>
                      <td class="text-left">
                        <select class="form-control js-initform" data-url="PAY_ORDER_WAY" id="receiptWay"  name="receiptWay"></select>
                      </td>
                    </tr>
					<tr id="openType-tr" style="display: none">
	                     <td class="text-right"><b>开立类型：<em class="text-star">*</em></b></td>
	                     <td class="text-left">
	                       <input type="text" class="form-control js-initform" id="openType" name="openType" />
                    </tr>
                    
                    <tr id="openDate-tr" style="display: none">
	                     <td class="text-right"><b>开立日期：<em class="text-star">*</em></b></td>
	                      <td class="text-left"><input type="text"class="form-control js-initform js_datePicker" id="openDate"name="openDate"></td>
                    </tr>
					<tr id="projectId-tr">
						<td class="text-right"><b>项目：<em class="text-star">*</em></b></td>
						<td class="text-left"><select
							class="form-control  js-initform" data-url="BUSI_UNIT_PROJECT"
							id="projectId" pid="busiUnit" name="projectId"></select></td>
					</tr>
					<tr id="custIdTr">
						<td class="text-right"><b>客户：<em class="text-star">*</em></b></td>
						<td class="text-left"><select
							class="form-control js-initform" data-url="PROJECT_BCS"
							id="custId" pid="projectId" name="custId"></select></td>
						</td>
					</tr>
					<tr id="custId-tr" style="display: none">
									<td class="text-right"><b>客户：<em class="text-star">*</em></b></td>
									<td class="text-left"><select
										class="form-control js-initform" data-url="BCS"
									    id="custIdName"	 name="custId"></select></td>
						</td>
					</tr>
		
					<tr>
						<td class="text-right"><b>付款单位：<em class="text-star">*</em></b></td>
						<td class="text-left"><input type="text" class="form-control js-initform"
								id="payUnit" name="payUnit"></input>
						</td>
					</tr>
					<tr>
						<td class="text-right"><b>摘要：</b></td>
						<td class="text-left"><input type="text" class="form-control js-initform"
								id="summary" name="summary"></input>
						</td>
					</tr>
                  </table>
            </div>
            <!-- /.box-body -->

             <div class="box-footer text-center">
              <button type="submit" id="save" class="btn btn-primary btn-sm" data-permissionUrl="/bankReceipt/update" data-url="bankReceipt/update">保存</button>
              <button type="button" id="back" data-url="html/pay/receipt/receiptSearch.html" class="btn btn-default btn-sm js-back">返回</button>
            </div>
            <!-- /.box-footer -->

          </form>
        </div>
  </section>
</div>
 
<script>
options.initPage = function(){
	$(".js_datePicker").datetimepicker({format:"Y-m-d", timepicker:false});
    var editData=GLOBAL.getEditData($("#form1"), options.param.id);
    var receiptWay = $("#receiptWay").val();
    var tabId = options.param.type;
    if(receiptWay == "2"){
      $("#openType-tr").css("display","");
      $("#openDate-tr").css("display","");
    }
    if(tabId==5){
    	$("#projectId-tr").hide();
    	$("#custId-tr").show();
    	$("#custIdTr").hide();   
    	$("#custIdName").val(editData.custId);
    }else{
    	$("#projectId-tr").show();
    	$("#custId-tr").hide();
    	$("#custIdTr").show();
    }
    
    $("#form1").validate({
        rules: {
            bankReceiptNo: {
                required: true
            },
            busiUnit: {
                required: true
            },
            recAccountNo: {
                required: true
            },
            receiptDate: {
                required: true
            },
            receiptAmount: {
                required: true
            },
            currencyType: {
                required: true
            },
            receiptWay: {
                required: true
            },
            openType: {
                required: true,
                digits : true
            },
            openDate: {
                required: true
            },
            projectId: {
                required: true,
                digits : true
            },
            custId: {
                required: true,
                digits : true
            },
            summary: {
                required: true
            },
            payUnit: {
              	maxlength:100
            }
        },
        submitHandler: function() {
          var data = $("#form1").serialize();
          var pattern = /^[0-9]*(\.[0-9]{1,2})?$/;
			var receiptAmount = $("#receiptAmount");
			if (!pattern.test(receiptAmount.val())) {
				layer.msg("请输入正确格式");
				receiptAmount.focus();
			} else {
	          GLOBAL.ajax("bankReceipt/update",data, function(e){
	        	  if (e.success) {
	            	  layer.msg("保存成功！", {
	                      icon: 1,
	                      time: 1500
	                  },function(){
	                	  GLOBAL.go("html/pay/receipt/receiptSearch.html");
	                  });
	              } else {
	                  layer.msg(e.msg);
	              }
	          });
			}
        }
    });
    
};

$(".tab-item").click(function(){
    var url = $(this).data("url");
    GLOBAL.go(url, options.param);
})

//付款方式为承兑汇票,需要显示开立类型
  $("#receiptWay").change(function(){
    var value = $(this).val();
    if(value == "2"){
      $("#openType-tr").css("display","");
      $("#openDate-tr").css("display","");
    }else{
      $("#openType-tr").css("display","none");
      $("#openDate-tr").css("display","none");
    }
    //清空 openType
    $("#openType").val("");
    $("#openDate").val("");
  })

GLOBAL.goBack();
  
</script>
