<div class="wrapper">
    <section class="content-header my-content-header">
        <ol class="breadcrumb">
            <li>当前位置</li>
            <li>发票</li>
            <li>境外开票收票</li>
            <li class="active">新建基本信息</li>
        </ol>
    </section>
    <section class="product-wrap">
        <div class="box no-margin">
            <form class="form-horizontal form-inline" id="form1">
                <div class="box-body">
                    <div class="row">
                            <table class="table table-bordered table-hover no-margin">
                                <tr>
                                    <td width="180" class="text-right"><b>项目：<em class="text-star">*</em></b></td>
                                    <td class="text-left">
                                        <select class="form-control js-select" data-url="USER_PROJECT" id="projectId" name="projectId"></select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-right"><b>客户：<em class="text-star">*</em></b></td>
                                    <td class="text-left">
                                        <select class="form-control js-select" data-url="PROJECT_CS" id="customerId" name="customerId" pid="projectId"> </select>
                                    </td>
                                </tr>
                                <tr>
									<td width="180" class="text-right"><b>币种：<em class="text-star">*</em></b></td>
									<td class="text-left">
										<select class="form-control js-select" data-url="DEFAULT_CURRENCY_TYPE" id="currnecyType" name="currnecyType"></select>
									</td>
								</tr>
								<tr>
									<td class="text-right"><b>收款单位：<em class="text-star">*</em></b></td>
									<td class="text-left">
										<select class="form-control js-select"  data-url="PROJECT_BUSI_UNIT" pid="projectId"  id="businessUnit" name="businessUnit">
										</select>
									</td>
								</tr>
								
								<tr>
									<td class="text-right"><b>收款账户：<em class="text-star">*</em></b></td>
									<td class="text-left">
										<select class="form-control js-select" data-url="SUBJECT_ACCOUNT" id="accountId" pid="businessUnit"  name="accountId"></select>
									</td>
								</tr>
								<tr class="hideByRequestPay">
									<td class="text-right"><b>开户行</b></td>
									<td class="text-left">
										<label class="js-initform" id="bankName" name="bankName"></label>
									</td>
								</tr>
								<tr class="hideByRequestPay">
									<td class="text-right"><b>开户名</b></td>
									<td class="text-left">
										<label class="js-initform" id="subjectName" name="subjectName"></label>
									</td>
								</tr>
								<tr class="hideByRequestPay">
									<td class="text-right"><b>银行账号</b></td>
									<td class="text-left">
										<label class="js-initform" id="accountNo" name="accountNo"></label>
									</td>
								</tr>
								
                                <tr class="gearbest_title">
                                    <td class="text-right"><b>结算周期：<em class="text-star">*</em></b></td>
                                    <td class="text-left">
                                        <input type="text" class="form-control js_datePicker" id="balanceStartDate" name="balanceStartDate">-
                                        <input type="text" class="form-control js_datePicker" id="balanceEndDate" name="balanceEndDate">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-right"><b>单据类别：<em class="text-star">*</em></b></td>
                                    <td class="text-left">
                                        <select class="form-control js-select" data-url="DOCUMENT_TYPE" id="billType" name="billType"> </select>
                                    </td>
                                </tr>
                                <tr id="taxBill-tr" style="display: none;">
                                      <td class="text-right"><b>开票明细：<em class="text-star">*</em></b></td>
                                      <td class="text-left">
                                          <select class="form-control js-select" data-url="BILL_DETAIL" id="feeType" name="feeType"> </select>
                                      </td>
                                  </tr>
                                <tr id="taxRate-tr" style="display: none">
                                    <td class="text-right"><b>同品合并：<em class="text-star">*</em></b></td>
                                    <td class="text-left">
                                        <input type="radio" id="isMerge" name="isMerge" value="1" checked="checked" />是
                                        <input type="radio" id="isMerge" name="isMerge" value="0" />否
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-right"><b>票据备注：</b></td>
                                    <td class="text-left">
                                        <textarea class="form-control js-initform" id="invoiceRemark" cols="50" rows="5" name="invoiceRemark"></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-right"><b>单据备注：</b></td>
                                    <td class="text-left">
                                        <textarea class="form-control js-initform" id="remark" cols="50" rows="5" name="remark"></textarea>
                                    </td>
                                </tr>
                            </table>
                </div>
                <!-- /.box-body -->
                <div class="box-footer text-center">
                    <button type="submit" id="save"  data-url="html/invoice/overseas/overseasInfoEdit.html" data-permissionUrl="/invoiceOverseas/add" class="btn btn-primary btn-sm">保存</button>
                    <button type="button" data-url="html/invoice/overseas/overseasInfoSearch.html" id="js-back" class="btn btn-default btn-sm">返回</button>
                </div>
                <!-- /.box-footer -->
            </form>
        </div>
    </section>
</div>
<script>
var options = {
    param: {
        id: 0,
        cid: 0
    },
    initPage: function() {
    	$(".js_datePicker").datetimepicker({
		    format:'Y-m-d',
		});
    	$(".hideByRequestPay").hide();
        $("#form1").validate({
            rules: {
            	projectId: {
                    required: true
                },
                businessUnit: {
                    required: true
                },
                customerId: {
                    required: true
                },
                currnecyType: {
                    required: true
                },
                accountId: {
                    required: true
                },
                balanceStartDate: {
                    required: true
                },
                balanceEndDate: {
                    required: true
                },
                billType: {
                    required: true
                },
                feeType: {
                    required: true
                },
                invoiceNo: {
                    required: true,
                    maxlength : 50
                },
                invoiceRemark: {
                	maxlength : 500
                },
                remark: {
                	maxlength : 500
                }
            },
            submitHandler: function() {
                var data = $("#form1").serialize();
                GLOBAL.ajax("invoiceOverseas/add", data, function(e) {
                    layer.msg("保存成功！", {
                        icon: 1,
                        time: 1500
                    }, function() {
                    	options.param.isMerge = $("input[type='radio']:checked").val();
                        options.param.id = e.items;
                        options.param.billType = $("#billType").val();
                        GLOBAL.go("html/invoice/overseas/overseasInfoEdit.html", options.param);
                    })

                }, false, $("#save"));
            }
        });
    }
}
$("#projectId").change(function(){ 
	 var id = $("#projectId").val(); 
	 if(id){
		 var data = {id : id}; 
		 GLOBAL.ajax("project/detail",data , function(e){  
			 $("#accountId").val(e.items.businessUnitId);
        });  
	  }else{
		  $("#accountId").val("");  
	  }
	 
	 
}); 
$("#accountId").change(
		function() {
			var value = $(this).val();
			if (value) {
				GLOBAL.ajax("baseSubject/account/edit?id=" + value, null,
						function(data) {
							$("#subjectName").text(data.items.subjectName);
							$("#accountNo").text(data.items.accountNo);
							$("#bankName").text(data.items.bankName);
						})
				$(".hideByRequestPay").show();
			} else {
				$(".hideByRequestPay").hide();
			}
		})


//单据类型
$("#billType").change(function() {
    var value = $(this).val();
    if (value == "2") {
    	$("#taxBill-tr").css("display", "");
        $("#taxRate-tr").css("display", "none");
    } else {
    	 $("#taxRate-tr").css("display", "");
         $("#taxBill-tr").css("display", "none");
    }
    //清空 openType
    //$("#invoiceTaxRate").val("0");
})


$(".js_datePicker").datetimepicker();

$("#js-back").click(function() {
    var url = $(this).data("url");
    GLOBAL.go(url);
})
</script>
