<!DOCTYPE html>
<html>
<title>送货单打印</title>
<!-- FontAwesome 4.3.0 -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!--bootstrap-->
<link href="../../../css/bootstrap_min.css" rel="stylesheet"
	type="text/css" />
<!--AdminLTE theme-->
<link href="../../../css/AdminLTE_min.css" rel="stylesheet"
	type="text/css" />
<!-- <link href="css/AdminLT_skins/_all-skins.min.css" rel="stylesheet" type="text/css" /> -->
<link href="../../../css/jquery.tag-editor.css" rel="stylesheet"
	type="text/css" />
<link rel="stylesheet" href="../../../css/sys_setting_min.css">
<link rel="stylesheet" href="../../../css/mainframe_min.css">
<link rel="stylesheet"
	href="../../../js/plugins/bootstrap-table/bootstrap-table.min.css">
<style type="text/css">
@page {
	size: auto; /* auto is the initial value */
	margin: 0mm; /* this affects the margin in the printer settings */
}

body, table {
	font-size: 12px;
}

table {
	margin: auto;
	border-collapse: collapse;
}

table.head {
	font-size: 13px;
	margin-top: -5px;
}

table.head td {
	height: 10px;
	overflow: hidden;
	white-space: nowrap;
}

div.whole {
	margin: 0px auto;
	padding-top: 30px;
	width: 730px;
}

td {
	vertical-align: middle;
}

td input {
	border: none;
	text-align: center;
	padding: 5px;
	font-size: 14px;
	cursor: pointer;
	width: 86%;
}

hr {
	margin: 5px 0 2px 0;
}

#qrcode {
	float: right;
}

#qrcode img {
	vertical-align: middle;
	margin: auto;
}
</style>
</head>

<body>
	<div class="whole">
		<div class="print-top">
			<button class="btn btn-primary mb20 printBtn">打印</button>
			<button class="btn btn-default mb20 closeBtn">关闭</button>
		</div>
		<form class="form-horizontal form-inline" id="form1"
			data-url="billOutStore/batch/print">
			<table width="100%">
				<tr>
					<td colspan="4">
						<table width="100%" style="float: left; width: 100%;">

							<tr>
								<td align="center"
									style="font-size: 23px; padding: 80px 0px 0px 0px">
									<!--                                     	<strong><label class="js-initform" id="businessChineseName" name="businessChineseName"/></strong>  -->
									送货单
								</td>
							</tr>
						</table>
						<div id="qrcode"></div>
					</td>
				</tr>
				<tr>
					<td class="pt10" colspan="4" style="border: 0; padding-top: 30px">
						<table id="js_dataTable" class="print-table" style="width: 100%">
							<!-- border:1px solid #000; -->
							<tr>
								<th align="left" style="padding: 10px 0px 0px 0px;"><span>TO
										: <label class="js-initform" id="customerName"
										name="customerName" />
								</span> <span style="float: right">FR :&nbsp; <label
										style="float: right" class="js-initform"
										id="businessChineseName" name="businessChineseName" /></span></th>
							</tr>
							<th align="left" style="padding: 1px 0px 0px 0px;"><br>
								<!--                                         <span  style="float:left" >TEL : <label class="js-initform" id="customerPhone" name="customerPhone"/></span> -->
								<span style="float: right">TEL : <label
									class="js-initform" id="businessUnitPhone"
									name="businessUnitPhone" /></span> <br></th>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td colspan="4" style="border: 0; padding: 20px 0px">
						<table width="100%" style="border: 0" class="poSearch_table">
							<thead>
								<tr>
									<th
										style="width: 8%; border: 1px solid #000; padding: 5px; text-align: center;">
										序号</th>
									<th
										style="width: 12%; border: 1px solid #000; padding: 5px; text-align: center;">
										订单号</th>
									<th
										style="width: 10%; border: 1px solid #000; padding: 5px; text-align: center;">
										SKU</th>
									<th
										style="width: 25%; border: 1px solid #000; padding: 5px; text-align: center;">
										产品名称</th>
									<!--                                 		<th style="width: 18%;border: 1px solid #000; padding: 5px; text-align: center;"> -->
									<!--                                 			产品型号 -->
									<!--                                 		</th> -->
									<th
										style="width: 10%; border: 1px solid #000; padding: 5px; text-align: center;">
										送货数量</th>
									<th
										style="width: 17%; border: 1px solid #000; padding: 5px; text-align: center;">
										送货日期</th>
								</tr>
							</thead>
							<tbody>

							</tbody>
							<tfoot>
								<tr>
									<td
										style="border: 0; padding: 3px; text-align: center; border: 1px solid #000;"
										colspan="1">合计:</td>
									<td
										style="border: 0; padding: 3px; text-align: center; border: 1px solid #000;"></td>
									<td
										style="border: 0; padding: 3px; text-align: center; border: 1px solid #000;"></td>
									<td
										style="border: 0; padding: 3px; text-align: right; border: 1px solid #000; padding: 0 5px;"></td>
									<!--                                         <td style="border: 0; padding: 3px; text-align: center;border: 1px solid #000;"></td> -->
									<td
										style="border: 0; padding: 3px; text-align: right; border: 1px solid #000;"><b><label
											class="js-initform" id="countSendNum"
											style="font-weight: bold;" /></b></td>
									<td
										style="border: 0; padding: 3px; text-align: right; border: 1px solid #000; padding: 0 5px;"></td>

								</tr>
							</tfoot>
						</table>
					</td>
				</tr>
				<tr>
				</tr>

				<tr>
					<td colspan="8" style="padding: 15px 0;">
						<table style="width: 100%">
							<tr>
								<td
									style="width: 110px; border: 0; padding: 5px; text-align: left; padding-right: 5px;">收货单位签收：</td>
								<td
									style="width: 250px; padding: 5px 0; padding-left: 0px; text-align: left;">
								</td>
								<td
									style="width: 160px; border: 0; padding: 5px; text-align: right; padding-right: 5px;">送货单位签章：</td>
								<td style="padding: 5px 0; padding-left: 5px; text-align: left;">

								</td>
							</tr>

						</table>
					</td>
				</tr>
			</table>
		</form>
	</div>
	<script src="../../../js/lib/jquery-1.9.1.min.js"
		type="text/javascript"></script>
	<script src="../../../js/lib/qrcode.min.js" type="text/javascript"></script>
	<script src='../../../js/plugins/bootstrap-table/bootstrap-table.js'
		type='text/javascript'></script>
	<script
		src='../../../js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js'
		type='text/javascript'></script>
	<script src='../../../js/plugins/layer/layer.js' type='text/javascript'></script>
	<script src="../../../js/common.js"></script>
</body>
<script>
	
    var ids = GLOBAL.getParam("ids");
    GLOBAL.ajax("billOutStore/batch/print", {ids: ids}, function(result) {
        if (result.success) {
            var data =result.items;
            if (data) {
				$("#form1").find(".js-initform").each(function(){
				     var $this = $(this);
	                    var id = $this.attr("id");
	                    var toThound = $this.hasClass("toThound");
	                    data[id] = data[id] == null ? "" : data[id];
	                    if (this.nodeName.toLowerCase() == "label") {
	                        if (data[id] || data[id] == 0) {
	                        	var showValue = toThound && !isNaN(parseFloat(data[id])) ? parseFloat(data[id]).toThounds() : data[id];                            
	                            $this.text(showValue);
	                        }
	                    } else {
	                        $this.val(data[id]);
	                    }
				});
				poLine();
            }
        }
    });
    function  poLine(){
  	  GLOBAL.ajax("billOutStoreDtl/batch/print", {ids: ids}, function(result) {
  	    	if (result.items) {
  	    		var tbody = "";
  	    		var number=0;
  	    		var amount=0;
  	    		var countSendNum=0;
  	    		for (var i = 0; i < result.items.length; i++) {
  	    			var data = result.items[i];
        			var deliverTime = "";
        			countSendNum=data.countSendNum;
        			if(data.deliverTime!=null)
        			{
        				deliverTime = data.deliverTime.substring(0, 10)
        			}
        		 var  tr = "<tr>" 
    				 + "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " +(i+1)+ "</td>"
 					+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " +data.billNo+ "</td>"
     				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.goodsNumber + "</ >"
     				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.goodsName + "</td>"
//      				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.goodsType + "</td>"
     				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'> " + data.sendNum+ "</td>"
     				+ "<td style='border: 1px solid #000; padding: 5px; text-align: center;'>" + deliverTime + "</td>"
     				+ "</tr>";
  	    			tbody += tr;
  	            }
  	            $(".poSearch_table").find("tbody").append(tbody); 
  	            $("#countSendNum").html(countSendNum.toFixed(2));
  	    	}
  	    });
    }
    function num(obj){
    	obj.value = obj.value.replace(/[^\d.]/g,""); //清除"数字"和"."以外的字符
    	obj.value = obj.value.replace(/^\./g,""); //验证第一个字符是数字
    	obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个, 清除多余的
    	obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
    	obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3'); //只能输入两个小数
    	}
    
        $(".printBtn").click(function() {
            $(this).parent(".print-top").hide();
            closeAfterPrint();
        })
        $(".closeBtn").click(function() {
            window.close();
        })

        function closeAfterPrint() {
            if (document.execCommand("print")) {
                $(".print-top").show();

                GLOBAL.ajax("common/batchUpdatePrintNum", {ids:ids, billType:3}, function(){
					//layer.msg("打印次数 + 1");
				});
            } else
                setTimeout("CloseAfterPrint();", 1000);
        }

        window.onafterprint = function() {
            alert("Printing completed...");
        }
    </script>

</html>
